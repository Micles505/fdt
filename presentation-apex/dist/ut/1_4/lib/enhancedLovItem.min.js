$.widget("pretius.enhancedLovItem",{C_VALUE_SEPARATOR:":",C_AJAX_STATUS_SUCCESS:"SUCCESS",C_AJAX_STATUS_ERROR:"ERROR",C_POPUP_SEARCH_PLACEHOLDER:"Enter a search term",C_POPUP_BTN_SELECT_TEXT:"Select",C_POPUP_SHOW_SELECTED_LABEL:"Show only selected",C_POPUP_TEXT_ROWS_SELECTED:"All results (%0) on this page has been selected.",C_POPUP_TEXT_NO_DATA_FOUND_SEARCH:'No data found for search term "%0".',C_POPUP_TEXT_NO_DATA_FOUND_QUERY:"Dictionary has no data to render.",C_POPUP_TEXT_CLEAR_FILTERING:'Click <a href="javascript: void(0)" class="clearFiltering">here</a> to clear filtering.',C_POPUP_TEXT_UNSAVED_CHANGES:"You have selected %0 values. Closing without saving will not save selected values.",C_POPUP_TEXT_SEACH_IN_SELECTED:'You have filtered %0 row(s) from %1 selected row(s). </br>Click <a href="javascript: void(0)" class="showSelected">here</a> to get back to all selected rows.',C_POPUP_TEXT_FILTERED_INFO:'%0 results found for search term "%1". ',C_POPUP_TEXT_EXTRA_VALUE:'Value "%0" is not within dictionary.',C_PROMPT_MENU_EXPAND_TITLE:"Show or hide all tags",C_PROMPT_MENU_SORT_TITLE:"Sort tags",C_PROMPT_MENU_CLEAR_TITLE:"Clear all selected values",C_PROMPT_TEXT_MINIMAL_INPUT_LENGTH_X:"Please enter %0 or more characters.",C_PROMPT_TEXT_MINIMAL_INPUT_LENGTH_0:"Start typing to get results.",C_PROMPT_TEXT_NO_DATA_FOUND:"No data found.",C_PROMPT_TEXT_SEARCHING:"Searching...",C_PROMPT_TEXT_RAPID_SELECTION:"Start typing to select more...",C_PROMPT_TEXT_LOAD_MORE:"Load more...",C_ERROR_DEBUG_OFF:"Please contact application administrator for more information.\nDetailed information available in debug mode.",C_TAGS_LIMITED_OTHERS:"and %0 more...",C_TAGS_LIMITED_0:"%0 selected",C_POPUP_PAGINATION_PREV:"Previous",C_POPUP_PAGINATION_NEXT:"Next",C_POPUP_HEADER_SORT_ASC_TITLE:"Sort ascending",C_POPUP_HEADER_SORT_DESC_TITLE:"Sort descending",C_POPUP_TEXT_SEARCHING:"Waiting for results...",C_PAGINATION_TEXT_OF_NBR_RECORD:" of ",_create:function(){var t,e=!1;if(this.logPrefix="# ("+this.element.get(0).id+") "+this.options.plugin.name+":",apex.debug.log(this.logPrefix,"_create","options",this.options,this),this._super(this.options),this._applyTranslations(),this.pluginStopped=!1,(null==this.options.attributes.popupSettings||null!=this.options.attributes.popupSettings&&-1==this.options.attributes.popupSettings.indexOf("RCC"))&&(e=!0),null!=this.options.attributes.popupSettings&&this.options.attributes.popupSettings.indexOf("CT")>-1?popupTitleText=this.options.attributes.popupTitleText:popupTitleText=this.options.item.plain_label,this.pluginSettings={isDebugOn:this.options.debug,displayExtra:this.options.item.lov_display_extra,popupSearchDebounceTime:300,isAutocompleteAvailable:null!=this.options.attributes.settings&&this.options.attributes.settings.indexOf("AUTOCOMPLETE")>-1,isPopupReportAvailable:null!=this.options.attributes.settings&&this.options.attributes.settings.indexOf("POPOUP_REPORT")>-1,isMultipleSelection:null!=this.options.attributes.settings&&this.options.attributes.settings.indexOf("MS")>-1,popup:{width:this.options.attributes.popupWidth,height:this.options.attributes.popupHeight,title:popupTitleText,rowsPerPage:10,isReportBasicConf:e,isReportAdvancedConf:null!=this.options.attributes.popupSettings&&this.options.attributes.popupSettings.indexOf("RCC")>-1,isDisplayColumnVisible:null!=this.options.attributes.popupReportBasicConf&&this.options.attributes.popupReportBasicConf.indexOf("DDC")>-1,isReturnColumnVisible:null!=this.options.attributes.popupReportBasicConf&&this.options.attributes.popupReportBasicConf.indexOf("DRC")>-1,clickOnRowSelectsIt:null!=this.options.attributes.popupSettings&&this.options.attributes.popupSettings.indexOf("CORSI")>-1,draggable:null!=this.options.attributes.popupSettings&&this.options.attributes.popupSettings.indexOf("DRAGGABLE")>-1,resizable:null!=this.options.attributes.popupSettings&&this.options.attributes.popupSettings.indexOf("RESIZABLE")>-1,closeOnEscape:null!=this.options.attributes.popupSettings&&this.options.attributes.popupSettings.indexOf("COE")>-1,showRowsPerPage:null!=this.options.attributes.popupSettings&&this.options.attributes.popupSettings.indexOf("RPP")>-1,searchInAllColumns:null!=this.options.attributes.popupSettings&&this.options.attributes.popupSettings.indexOf("SIAC")>-1,adjustHeightToResults:null!=this.options.attributes.popupSettings&&this.options.attributes.popupSettings.indexOf("AHTRR")>-1},prompt:{maxHeight:parseInt(this.options.attributes.autoCompleteMaxHeight),navigationDebounceTime:10,debounceTime:200,rowsPerPage:parseInt(this.options.attributes.autoCompleteRows2Show),areTagsLimited:null!=this.options.attributes.autoCompleteSettings&&this.options.attributes.autoCompleteSettings.indexOf("LDT")>-1,isCustomTemplate:null!=this.options.attributes.autoCompleteSettings&&this.options.attributes.autoCompleteSettings.indexOf("UCT")>-1,tagsNo:this.options.attributes.autoCompleteTagsNo,template:this.options.attributes.autoCompleteSettingsTemplate,isMinimalInputLength:null!=this.options.attributes.autoCompleteSettings&&this.options.attributes.autoCompleteSettings.indexOf("MIL")>-1,minimalInputLength:this.options.attributes.autoCompleteMinInputLength,isRapidSelection:null!=this.options.attributes.autoCompleteSettings&&this.options.attributes.autoCompleteSettings.indexOf("RS")>-1}},this.inputCss={borderColor:this.element.css("borderColor"),fontSize:this.element.css("fontSize"),lineHeight:this.element.css("lineHeight")},null!=this.options.item.lov_cascade_parent_items&&$("#"+this.options.item.lov_cascade_parent_items).on("change",$.proxy(this._cascadingLovItem,this)),this.mask=this._maskCreateNew(),this.mask=$.extend(this.mask,{state:{xhr:void 0,isVisible:!1,currentSearchText:"",lastFetchedPage:null,totalCount:0,ajaxRunning:!1,currentSelection:void 0,areResultsAvailable:!1,selected:[],tags:[],sorted:void 0,disabled:!1,extraValues:[],error:!1}}),this.prompt={customTemplateFunction:this._promptPrepateCustomTemplateFunction(),container:void 0,fixBorder:void 0,header:void 0,body:void 0,input:void 0,isVisible:!1},this.pluginSettings.isPopupReportAvailable){if(this.pluginSettings.popup.isReportAdvancedConf)try{t=JSON.parse(this.options.attributes.popupColumnSettings)}catch(t){this._maskAjaxStateButtonSetError({addInfo:t.name+": "+t.message,error:'Invalid plugin "'+this.options.plugin.name+'" configuration.',techInfo:[{name:"Reason",value:"Parsing JSON object for popup report failed: inavlid JSON object."},{name:"JSON object to parse",value:this.options.attributes.popupColumnSettings}]},!0),this._maskAjaxStateButtonError()}this.popup={defaultReportSettings:{thAlign:"left",tdAlign:"left",visible:!0,sort:!0,filter:!0},headers:t,container:this._popupCreateNew(),headerActionContainer:void 0,state:{informationText:void 0,informationTemplate:void 0,selecting:!1,xhr:void 0,isVisible:!1,lastFetchedPage:null,searchString:void 0,searchStringOnFocus:void 0,sortedColumnIdx:null,sortedColumnDirection:"asc",ajaxRunning:!1,searchColumnIdx:void 0,ajaxDataFetchedCount:0,ajaxDataTotalCount:void 0,ajaxStatus:void 0,ajaxCurrentPageData:[],ajaxSelectedData:[],ajaxCurrentPageRownumStart:void 0,ajaxCurrentPageRownumEnd:void 0,cache:[],selected:[],selectedHash:0}},this.popup=$.extend(this.popup,{dialogHeader:this.popup.container.parent().find(".ui-dialog-titlebar"),header:this.popup.container.find(".header"),informationContainer:this.popup.container.find(".information"),informationText:this.popup.container.find(".information .text"),body:this.popup.container.find(".body"),footer:this.popup.container.find(".footer"),showSelectedContainer:this.popup.container.find(".footer-showSelected"),stickyHeaders:void 0,search:this.popup.container.find(".searchContainer :input"),selectAllCheckbox:void 0,showSelectedCheckbox:this.popup.container.find(".footer :checkbox"),showSelectedLabel:this.popup.container.find(".footer label"),clear:this.popup.container.find(".searchContainer .clear"),select:this.popup.container.find(".select"),paginationContainer:this.popup.container.find(".paginationContainer"),paginationPrevPage:this.popup.container.find(".prev"),paginationNextPage:this.popup.container.find(".next"),paginationCurrent:this.popup.container.find(".current"),rowsPerPage:this.popup.container.find("select"),contentTable:void 0,rowsPerPageContainer:this.popup.container.find(".rowsPerPageContainer")}),this.popup.body.on("scroll",$.proxy(this._popupScrollCallback,this)),this.popup.clear.on("click",$.proxy(this._popupSearchClear,this,!0)),this.popup.paginationPrevPage.on("click",$.proxy(this._popupPaginationPrevPage,this)),this.popup.paginationNextPage.on("click",$.proxy(this._popupPaginationNextPage,this)),this.popup.rowsPerPage.on("change",$.proxy(this._popupChangeRowsPerPage,this)),this.popup.showSelectedCheckbox.on("change",$.proxy(this._popupShowSelectedCheckboxChange,this)),this.pluginSettings.popup.clickOnRowSelectsIt&&this.popup.container.on("click","td",$.proxy(this._popupClickOnCell,this)),this.popup.container.on("click",".fakeCheckbox",$.proxy(this._popupFakeCheckboxClick,this)).on("click","button.select",$.proxy(this._popupSelectAndClose,this)).on("click","a.showSelected",$.proxy(this._popupShowSelectedCheckboxChange,this)).on("click","a.clearFiltering",$.proxy(this._popupClearFiltering,this)).on("click",".fakeRadio",$.proxy(this._popupFakeRadioClick,this)).on("change","th:first-child :checkbox",$.proxy(this._popupThCheckboxChange,this)).on("change","td:first-child :checkbox",$.proxy(this._popupTdCheckboxChange,this)).on("change","td:first-child :radio",$.proxy(this._popupTdRadioChange,this)),this.popup.search.on("keyup",this._debounce($.proxy(this._popupSearchKeyUp,this,null,null),this.pluginSettings.popupSearchDebounceTime)).on("keyup",$.proxy(this._maskKeyUpManageIcons,this)).on("focus",$.proxy(this._popupSearchFocus,this))}this.mask.itemContainer.on("click",$.proxy(this._promptSearchInputFocusHandler,this)).on("focus",$.proxy(this._maskHandleFocus,this)).on("blur",$.proxy(this._maskHandleBlur,this)).on("keypress",$.proxy(this._maskHandleKeyPress,this)).on("keydown",$.proxy(this._maskHandleKeyDown,this)),this.mask.tagsContainer.on("click",".remove",$.proxy(this._maskRemoveTagFromDOM,this)),this.mask.popupButton.on("keydown",$.proxy(this._maskPopupButtonKeyDown,this)),this.widgetUniqueId=$("<div></div>").uniqueId().attr("id"),apex.debug.log(this.logPrefix,"_create","Plugin instance created. Unique id = "+this.widgetUniqueId,this.options),this.pluginSettings.isDebugOn&&this._createMaskDebugButton(),this.element.val().length>0&&!this.pluginStopped&&this._getOnLoadLov(this.element.val()),this._integrateWithApexApi(),$(window).resize($.proxy((function(){apex.debug.log(this.logPrefix,"window resized, reposition prompt"),this.prompt.isVisible&&this._promptReposition()}),this)),this.element.after(this.mask.container),this.element.hide(),this.element.on("apexrefresh",$.proxy(this._manualRefreshCallback,this)),apex.debug.log(this.logPrefix,"pluginSettings",this.pluginSettings)},_destroy:function(){},_setOption:function(t,e){"value"===t&&(e=this._constrain(e)),this._super(t,e)},options:function(t){this._super(t)},_setOptions:function(t){this._super(t)},_cascadingLovItem:function(){apex.debug.log(this.logPrefix,"_cascadingLovItem");var t={x01:"CASCADINGLOV",pageItems:"#"+this.options.item.lov_cascade_parent_items},e={beforeSend:$.proxy((function(){this._maskAjaxStateButtonRunning()}),this),complete:$.proxy((function(){this._maskAjaxStateButtonHide()}),this)};apex.server.plugin(this.options.plugin.ajaxIdentifier,t,e)},_triggerEvent:function(t,e){apex.debug.log(this.logPrefix,"_triggerEvent"),apex.event.trigger(this.element.get(0),t,e)},_manualRefreshCallback:function(){apex.debug.log(this.logPrefix,"_manualRefreshCallback"),this._getOnLoadLov()},_getColumnIdxByColumnName:function(t){var e;for(var i in apex.debug.log(this.logPrefix,"_getColumnIdxByColumnName","pColumnName",t,"columns",this.options.columns),this.options.columns)if(this.options.columns[i].COLUMN_NAME==t){apex.debug.log(this.logPrefix,'_getColumnIdxByColumnName column "'+t+'" found, return its IDX.'),e=this.options.columns[i].IDX;break}return null==e&&(apex.debug.log(this.logPrefix,'_getColumnIdxByColumnName column "'+t+'" not found, return 1st column.',this.options.columns[0].IDX),e=this.options.columns[0].IDX),apex.debug.log(this.logPrefix,'_getColumnIdxByColumnName returns "'+e+'"'),e},printFunctionToConsole:function(t){apex.debug.log(this.logPrefix,"printFunctionToConsole");for(var e=t.split("\n"),i=0;i<e.length;i++)apex.debug.info(this.logPrefix,"#",e[i])},_promptPrepateCustomTemplateFunction:function(){var t;apex.debug.log(this.logPrefix,"_promptPrepateCustomTemplateFunction");try{t=new Function("pRow",'this.data = pRow;\n//apex.debug.log("'+this.logPrefix+'", "promptCustomTemplate", pRow);\n'+this.pluginSettings.prompt.template),this.printFunctionToConsole(t.toString()),apex.debug.log(this.logPrefix,"_promptPrepateCustomTemplateFunction","function created")}catch(t){apex.debug.log(this.logPrefix,"_promptPrepateCustomTemplateFunction","function can't be created: "+t.message),this.printFunctionToConsole(this.pluginSettings.prompt.template),this._maskAjaxStateButtonSetError({addInfo:"Function returning prompt template has errors.",error:'Invalid plugin "'+this.options.plugin.name+'" configuration.',techInfo:[{name:t.name,value:t.message},{name:"Function",value:this.pluginSettings.prompt.template}]},!0),this._maskAjaxStateButtonError()}return t},_applyTranslations:function(){var t=this.options.attributes.translations;if(t.length>0)for(var e in t)apex.debug.log(this.logPrefix,"_applyTranslations",t[e].TRANSLATABLE_MESSAGE,t[e].MESSAGE_TEXT),this[t[e].TRANSLATABLE_MESSAGE.replace("PAELI_","C_")]=t[e].MESSAGE_TEXT},_integrateWithApexApi:function(){apex.debug.log(this.logPrefix,"_integrateWithApexApi",this.element.get(0));var t={setValue:$.proxy((function(t,e){apex.debug.log(this.logPrefix,"_integrateWithApexApi","setValue",'pValue="'+t+'"','pDisplayValue="'+e+'"'),arguments[2]||apex.debug.log(this.logPrefix,"_integrateWithApexApi","setValue",'Suppress Change Event is set to "No". Change event will be doubled.'),0==t.length?(this._promptEmptyTags(),this._promptEmptyMask(),this.element.val(null)):this._getOnLoadLov(t)}),this),nullValue:"",enable:$.proxy((function(){apex.debug.log(this.logPrefix,"_integrateWithApexApi",this.element.get(0).id,"enable"),this._enable()}),this),disable:$.proxy((function(){apex.debug.log(this.logPrefix,"_integrateWithApexApi",this.element.get(0).id,"disable"),this._disable()}),this),afterModify:$.proxy((function(){apex.debug.log(this.logPrefix,"_integrateWithApexApi",this.element.get(0).id,"afterModify",this.element.val())}),this),loadingIndicator:$.proxy((function(t){return apex.debug.log(this.logPrefix,"_integrateWithApexApi",this.element.get(0).id,"loadingIndicator"),t}),this),isChanged:$.proxy((function(){})),setFocusTo:$.proxy((function(){return apex.debug.log(this.logPrefix,"_integrateWithApexApi",this.element.get(0).id,"setFocusTo"),this.mask.popupButton}),this),setStyleTo:this.mask.container,getValue:$.proxy((function(){return apex.debug.log(this.logPrefix,"_integrateWithApexApi",this.element.get(0).id,"getValue"),this.element.val()}),this),show:$.proxy((function(){apex.debug.log(this.logPrefix,"_integrateWithApexApi",this.element.get(0).id,"show")}),this),hide:$.proxy((function(){apex.debug.log(this.logPrefix,"_integrateWithApexApi",this.element.get(0).id,"hide")}),this),addValue:$.proxy((function(t){apex.debug.log(this.logPrefix,"_integrateWithApexApi",this.element.get(0).id,"addValue",t)}),this)};apex.widget.initPageItem(this.element.attr("id"),t)},_disable:function(){apex.debug.log(this.logPrefix,"_disable"),this.element.prop("disabled",!0),this.mask.state.disabled=!0,this.mask.container.addClass("disabled"),this.mask.popupButton.prop("disabled",!0)},_enable:function(){apex.debug.log(this.logPrefix,"_enable"),this.element.prop("disabled",!1),this.mask.state.disabled=!1,this.mask.container.removeClass("disabled"),this.mask.popupButton.prop("disabled",!1)},_createMaskDebugButton:function(){apex.debug.log(this.logPrefix,"_createMaskDebugButton");var t=$('<button class="debugAutocomplete a-Button a-Button--popupLOV"><span class="fa fa-info"></span></button>').click($.proxy((function(t){t.preventDefault(),apex.debug.log(this.logPrefix,"debug prompt",this.mask)}),this));t.attr("title","Writes to console autocomplete state"),this.mask.popupButton.after(t)},_getExtraValues:function(t,e){apex.debug.log(this.logPrefix,"_getExtraValues( "+this.element.get(0).id+" )"),apex.debug.log(this.logPrefix,"_getExtraValues","pValuesSent",t),apex.debug.log(this.logPrefix,"_getExtraValues","pDataReturned",e.length,e);for(var i=$.extend([],t).filter((function(t){return null!=t&&t.length>0})),o=0;o<e.length;o++)indexOf=i.indexOf(e[o].R.toString()),indexOf>-1?(i.splice(indexOf,1),apex.debug.log(this.logPrefix,"_getExtraValues","removing "+e[o].R.toString()+" from ",i)):apex.debug.log(this.logPrefix,"_getExtraValues","looking for "+e[o].R.toString()+" in ",i);return apex.debug.log(this.logPrefix,"_getExtraValues","extraValues",i),i},_maskPopupButtonHide:function(){apex.debug.log(this.logPrefix,"_maskPopupButtonHide"),this.mask.popupButton.hide()},_maskPopupButtonShow:function(){apex.debug.log(this.logPrefix,"_maskPopupButtonShow"),this.mask.popupButton.show()},_maskAjaxStateButtonHide:function(){apex.debug.log(this.logPrefix,"_maskAjaxStateButtonHide"),this._maskPopupButtonShow(),this.mask.ajaxStateButton.button.hide()},_maskAjaxStateButtonSetError:function(t,e){apex.debug.log(this.logPrefix,"_maskAjaxStateButtonSetError"),apex.debug.log(this.logPrefix,"_maskAjaxStateButtonSetError","pObject",t),apex.debug.log(this.logPrefix,"_maskAjaxStateButtonSetError","pStopPlugin",e),$.extend(this.mask.ajaxStateButton,{errorObject:t}),this.mask.state.error=!0,e&&(apex.debug.log(this.logPrefix,"_maskAjaxStateButtonSetError stop plugin!"),this.pluginStopped=!0,this.mask.state.disabled=!0)},_maskAjaxStateButtonDisplayError:function(){apex.debug.log(this.logPrefix,"_maskAjaxStateButtonDisplayError");var t=$('<div class="container"></div>'),e=$('<div class="error"></div>'),i=$('<div class="message"></div>'),o=$("<div></div>"),p=$("<pre></pre>"),s={dialogClass:"pretius--enhancedLovItem error",autoOpen:!0,appendTo:"body",modal:!0,position:{my:"center",at:"center",of:window},title:this.pluginSettings.popup.title,width:800,minWidth:500,height:541,minHeight:255,resizable:!1,draggable:!1,"closeOnEscape ":!0,open:$.proxy((function(){$("body").addClass("apex-no-scroll")}),this),beforeClose:$.proxy((function(){$("body").removeClass("apex-no-scroll")}),this)};if(0==this.pluginStopped&&(this._maskPopupButtonShow(),this.mask.ajaxStateButton.button.hide()),this.pluginSettings.isDebugOn)if(null!=this.mask.ajaxStateButton.errorObject.techInfo&&this.mask.ajaxStateButton.errorObject.techInfo instanceof Array)for(var a=0;a<this.mask.ajaxStateButton.errorObject.techInfo.length;a++)p.append(this.mask.ajaxStateButton.errorObject.techInfo[a].name+": "+this.mask.ajaxStateButton.errorObject.techInfo[a].value),p.append("\n");else null!=this.mask.ajaxStateButton.errorObject.techInfo&&p.append(this.mask.ajaxStateButton.errorObject.techInfo);else p.append(this.C_ERROR_DEBUG_OFF);i.append(this.mask.ajaxStateButton.errorObject.error),e.append(this.mask.ajaxStateButton.errorObject.addInfo),o.append(p),t.append(i).append(e).append(o).dialog(s)},_maskAjaxStateButtonError:function(){apex.debug.log(this.logPrefix,"_maskAjaxStateButtonError",this.pluginStopped),this._maskPopupButtonHide(),this.mask.ajaxStateButton.button.find(".icon").removeClass().addClass("icon fa fa-exclamation-triangle fa-anim-flash error"),this.mask.ajaxStateButton.button.show(),this.pluginStopped?this.mask.ajaxStateButton.button.on("click",$.proxy(this._maskAjaxStateButtonDisplayError,this)):this.mask.ajaxStateButton.button.one("click",$.proxy(this._maskAjaxStateButtonDisplayError,this))},_maskAjaxStateButtonRunning:function(){apex.debug.log(this.logPrefix,"_maskAjaxStateButtonRunning"),this._maskPopupButtonHide(),this.mask.ajaxStateButton.button.find(".icon").removeAttr("class").addClass("icon fa fa-refresh fa-anim-spin"),this.mask.ajaxStateButton.button.show()},_maskAjaxStateButtonShow:function(){apex.debug.log(this.logPrefix,"_maskAjaxStateButtonShow"),this.mask.ajaxStateButton.button.show()},_getOnLoadLov:function(t){apex.debug.log(this.logPrefix,"_getOnLoadLov");var e=null==t||null==t?"GETSESSIONSTATE":"GETONLYSELECTED",i=null==t||null==t?[]:t.split(this.C_VALUE_SEPARATOR),o=null==this.options.item.lov_cascade_parent_items||null==this.options.item.lov_cascade_parent_items?"":"#"+this.options.item.lov_cascade_parent_items;ajaxData={x01:e,f01:i,pageItems:o},ajaxOptions={beforeSend:$.proxy((function(t,e){apex.debug.log(this.logPrefix,"_getOnLoadLov","before send"),this._maskAjaxStateButtonRunning()}),this),success:$.proxy((function(t,e,i,o,p){var s,a,n;for(apex.debug.log(this.logPrefix,"_getOnLoadLov","success","pMode",t),apex.debug.log(this.logPrefix,"_getOnLoadLov","success","pValuesSent",e),apex.debug.log(this.logPrefix,"_getOnLoadLov","success","pData",i),apex.debug.log(this.logPrefix,"_getOnLoadLov","success","pTextStatus",o),apex.debug.log(this.logPrefix,"_getOnLoadLov","success","pJqXHR",p),i.data.sort(this._sortJson("D","asc")),this.mask.state.sorted="asc",this._promptEmptyTags(),this._promptEmptyMask(),n=0;n<i.data.length;n++)s={value:i.data[n].R.toString(),display:i.data[n].D},this._maskStateSelectedAdd(s,!1,!1);if("GETSESSIONSTATE"==t&&(e=i.session),this.pluginSettings.displayExtra&&null!=e&&e.length>0)for(a=this._getExtraValues(e.split(this.C_VALUE_SEPARATOR),i.data),n=0;n<a.length;n++)s={value:a[n],display:a[n]},this._maskStateSelectedAdd(s,!1,!0);this._promptRenderTags(),this._promptApplyValues(!1),this._maskAjaxStateButtonHide(),0==this.pluginSettings.isMultipleSelection&&this.mask.state.selected.length>1&&(this._maskAjaxStateButtonSetError({error:"Invalid input value according to its configuration.",addInfo:"The item is defined to support singular selection but session contains multiple values.",techInfo:'Check session value for APEX item "'+this.element.attr("id")+'" and inspect processes handling session value of item.'},!1),this._maskAjaxStateButtonError(),this._throwErrorText('Invalid input value according to its configuration.The item is defined to support singular selection but session contains multiple values.Check session value for APEX item "'+this.element.attr("id")+'" and inspect processes handling session value of item.'))}),this,e,t),error:$.proxy((function(t,e,i){apex.debug.log(this.logPrefix,"_getOnLoadLov","error"),apex.debug.log(this.logPrefix,"_getOnLoadLov","pJqXHR",t),apex.debug.log(this.logPrefix,"_getOnLoadLov","pTextStatus",e),apex.debug.log(this.logPrefix,"_getOnLoadLov","pErrorThrown",i),this.element.val().length>0&&this._maskDrawTagsFromInvalidValues(),this._maskAjaxStateButtonSetError({addInfo:t.responseJSON.addInfo,error:t.responseJSON.error,techInfo:t.responseJSON.techInfo}),this._maskAjaxStateButtonError(),this._throwErrorText(i)}),this),complete:$.proxy((function(){}),this)},apex.debug.log(this.logPrefix,"_getOnLoadLov","values to get tags",i),apex.server.plugin(this.options.plugin.ajaxIdentifier,ajaxData,ajaxOptions)},_maskDrawTagsFromInvalidValues:function(){apex.debug.log(this.logPrefix,"_maskDrawTagsFromInvalidValues");var t=this.element.val().split(this.C_VALUE_SEPARATOR);if(t.length>0){for(var e in t)this._promptTagsAddNew(t[e],t[e],!0);this._promptPlaceHolderHide()}},_popupSelectedGetValueArr:function(){apex.debug.log(this.logPrefix,"_popupSelectedGetValueArr");for(var t=[],e=0;e<this.popup.state.selected.length;e++)this.popup.state.selected[e].isAPEXNullValue||t.push(this.popup.state.selected[e].value);return apex.debug.log(this.logPrefix,"_popupSelectedGetValueArr",t),t},_popupAjaxGetOnlySelected:function(){apex.debug.log(this.logPrefix,"_popupAjaxGetOnlySelected");var t=null==this.options.item.lov_cascade_parent_items||null==this.options.item.lov_cascade_parent_items?"":"#"+this.options.item.lov_cascade_parent_items,e={x01:"GETONLYSELECTED",f01:this._popupSelectedGetValueArr(),pageItems:t},i={beforeSend:$.proxy(this._popupAjaxBeforeSend,this),success:$.proxy(this._popupAjaxSuccess,this),error:$.proxy(this._popupAjaxError,this),complete:$.proxy(this._popupAjaxComplete,this)};this.popup.state.xhr=apex.server.plugin(this.options.plugin.ajaxIdentifier,e,i)},_popupAjaxPerform:function(t,e,i,o,p){apex.debug.log(this.logPrefix,"_popupAjaxPerform");var s=null==this.options.item.lov_cascade_parent_items||null==this.options.item.lov_cascade_parent_items?"":"#"+this.options.item.lov_cascade_parent_items,a={x01:"POPUP",x02:this._popupGetRowsPerPage(),x03:o,x04:null==t?1:t,x05:e,x06:i,x07:p,pageItems:s},n={beforeSend:$.proxy(this._popupAjaxBeforeSend,this),success:$.proxy(this._popupAjaxSuccess,this),error:$.proxy(this._popupAjaxError,this),complete:$.proxy(this._popupAjaxComplete,this)};if(this.popup.state.ajaxRunning)return this._popupAjaxAbort(),void setTimeout($.proxy(this._popupAjaxPerform,this,t,e,i,o,p),300);this.popup.state.searchString=o,this.popup.state.lastFetchedPage=null==t?1:t,this.popup.state.sortedColumnIdx=e,this.popup.state.sortedColumnDirection=i,this.popup.state.searchColumnIdx=p,this.popup.state.xhr=apex.server.plugin(this.options.plugin.ajaxIdentifier,a,n)},_popupAjaxBeforeSend:function(t,e){apex.debug.log(this.logPrefix,"_popupAjaxBeforeSend"),this.popup.state.ajaxRunning=!0,this.popup.contentTable=void 0,this.popup.body.addClass("searching"),this.popup.state.isVisible&&null!=this.popup.headerActionContainer&&this._popupReportHeaderWidgetHide(),this._popupReportRenderSearching(0)},_popupAjaxDataFindIndexByReturnValue:function(t,e){apex.debug.log(this.logPrefix,"_popupAjaxDataFindIndexByReturnValue","pReturnValue",e);for(var i=0;i<t.data.length;i++)if(t.data[i].R==e)return apex.debug.log(this.logPrefix,"_popupAjaxDataFindIndexByReturnValue","pReturnValue found at index "+i),i;return apex.debug.log(this.logPrefix,"_popupAjaxDataFindIndexByReturnValue","pReturnValue not found"),-1},_popupExtendDataWithNullValues:function(t){apex.debug.log(this.logPrefix,"_popupExtendDataWithNullValues","pData",t);for(var e=!1,i=0;i<this.popup.state.selected.length;i++)if(this.popup.state.selected[i].isAPEXNullValue){e=!0;break}return t.data.unshift({R:this.options.item.lov_null_value,D:this.options.item.lov_null_text,isAPEXNullValue:!0,selected:e}),t},_popupExtendDataWithExtraValues:function(t){apex.debug.log(this.logPrefix,"_popupExtendDataWithExtraValues","pData",t);for(var e,i=$.extend([],t.data),o=0;o<this.popup.state.selected.length;o++)-1==this._popupAjaxDataFindIndexByReturnValue(t,this.popup.state.selected[o].value)&&((e={R:this.popup.state.selected[o].value,D:this.popup.state.selected[o].display,selected:!0,extra:!0}).R==this.options.item.lov_null_value&&(e.extra=!1,e.isAPEXNullValue=!0),i.unshift(e));return t.data=i,t},_popupAjaxSuccess:function(t,e,i){apex.debug.log(this.logPrefix,"_popupAjaxSuccess","pData",t);var o=this.C_POPUP_TEXT_FILTERED_INFO.replace("%0",t.totalCount).replace("%1",t.searchString)+this.C_POPUP_TEXT_CLEAR_FILTERING;this.popupInformationHide(),this.popup.state.ajaxStatus=this.C_AJAX_STATUS_SUCCESS,this.popup.state.sortedColumnDirection=t.sortByColumnDirection,this.popup.state.sortedColumnIdx=t.sortByColumnIdx,this.popup.state.lastFetchedPage=t.requestedPage,this.popup.state.searchString=t.searchString,this.popup.state.searchColumnIdx=t.searchColumnIdx,this.popup.state.ajaxDataTotalCount=t.totalCount,this.popup.state.ajaxCurrentPageData=this._dataExtendSelectedFromArrayOfObjects(t,this.popup.state.selected).data,this.popup.state.ajaxCurrentPageRownumStart=t.rownumStart,this.popup.state.ajaxCurrentPageRownumEnd=t.rownumEnd,"GETONLYSELECTED"==t.request?(t=this._popupExtendDataWithExtraValues(t),this.popup.state.ajaxSelectedData=this.popup.state.ajaxCurrentPageData,this._popupRowsPerPageHide(),this._popupPaginationHide()):"POPUP"==t.request&&(this._popupRowsPerPageShow(),this._popupPaginationShow(),null!=t.searchString&&t.data.length>0&&this._popupInformationAppend(o,this.C_POPUP_TEXT_FILTERED_INFO),1!=this.popup.state.lastFetchedPage||null!=t.searchString||null==this.options.item.lov_null_text&&null==this.options.item.lov_null_value||(t=this._popupExtendDataWithNullValues(t))),this._popupReportRender(t),this.popup.state.searchString||this.popup.state.searchColumnIdx||this.popup.search.val(null),null!=t.query&&this._writeQueryToConsole(t.query),apex.debug.log(this.logPrefix,"_popupAjaxSuccess","state",this.popup.state)},_popupAjaxDrawError:function(t){apex.debug.log(this.logPrefix,"_popupAjaxDrawError",t);var e=$('<div class="ajaxError"></div>'),i=$('<div class="error"></div>'),o=$('<div class="message"></div>'),p=$("<div></div>"),s=$("<pre></pre>");if(this.pluginSettings.isDebugOn)for(var a=0;a<t.techInfo.length;a++)s.append(t.techInfo[a].name+": "+t.techInfo[a].value),s.append("\n");else s.append(this.C_ERROR_DEBUG_OFF);o.append(t.error),i.append(t.addInfo),p.append(s),e.append(o).append(i).append(p),this.popup.body.empty().append(e),this._popupPaginationHide(),this._popupRowsPerPageHide()},_popupAjaxError:function(t,e,i){var o;if(apex.debug.log(this.logPrefix,"_popupAjaxError","pJqXHR",t),apex.debug.log(this.logPrefix,"_popupAjaxError","pTextStatus",e),apex.debug.log(this.logPrefix,"_popupAjaxError","pErrorThrown",i),"abort"!=t.statusText){if(this.popup.state.ajaxStatus=this.C_AJAX_STATUS_ERROR,this.popup.state.ajaxDataFetchedCount=void 0,this.popup.state.ajaxDataTotalCount=void 0,this._popupHeaderHide(),this._popupFooterHide(),null!=t.responseJSON.techInfo){this._popupAjaxDrawError(t.responseJSON);for(var p=0;p<t.responseJSON.techInfo.length;p++)if(apex.debug.log(this.logPrefix,"PL/SQL",t.responseJSON.techInfo[p].name,t.responseJSON.techInfo[p].value),t.responseJSON.techInfo[p].value.indexOf("\n")>-1){o=t.responseJSON.techInfo[p].value.split("\n");for(var s=0;s<o.length;s++)apex.debug.log(this.logPrefix,"PL/SQL",t.responseJSON.techInfo[p].name,o[s])}}this._popupAjaxComplete(),this._triggerEvent("paeli_popup_error",this._popupGetEventData()),this._throwError(i)}else apex.debug.log(this.logPrefix,"_popupAjaxError","AJAX call aborted!")},_popupAjaxComplete:function(){apex.debug.log(this.logPrefix,"_popupAjaxComplete"),this.popup.state.ajaxRunning=!1,apex.debug.log(this.logPrefix,"_popupAjaxComplete","popup state",this.popup.state)},_popupAjaxAbort:function(){apex.debug.log(this.logPrefix,"_popupAjaxAbort"),this.popup.state.xhr.abort(),this.popup.state.ajaxRunning=!1},_popupGetSelectedHash:function(){apex.debug.log(this.logPrefix,"_popupGetSelectedHash");var t=this.popup.state.selected.map((function(t,e,i){return t.value})),e=this._getHashCode(t.join(":"));return apex.debug.log(this.logPrefix,"_popupGetSelectedHash returns ",e),e},_getHashCode:function(t){apex.debug.log(this.logPrefix,"_getHashCode",t);var e,i=0;if(0===t.length)return i;for(e=0;e<t.length;e++)i=(i<<5)-i+t.charCodeAt(e),i|=0;return apex.debug.log(this.logPrefix,"_getHashCode returns",i),i},_popupDialogBeforeCloseCallback:function(t,e){return apex.debug.log(this.logPrefix,"_popupDialogBeforeCloseCallback",t,e),this.popup.state.selecting?(this.popup.state.selecting=!1,!0):this.popup.state.selectedHash==this._popupGetSelectedHash()||confirm(this.C_POPUP_TEXT_UNSAVED_CHANGES.replace("%0",this.popup.state.selected.length))},_promptPlaceHolderShow:function(){apex.debug.log(this.logPrefix,"_promptPlaceHolderShow"),this.mask.placeholder.show()},_promptPlaceHolderHide:function(){apex.debug.log(this.logPrefix,"_promptPlaceHolderHide"),this.mask.placeholder.hide()},_promptEmptyTags:function(){apex.debug.log(this.logPrefix,"_promptEmptyTags"),this.mask.state.tags=[],this.mask.tagsContainer.empty()},_promptEmptyMask:function(){apex.debug.log(this.logPrefix,"_promptEmptyMask"),this.mask.state.selected=[]},_popupSelectAndClose:function(){apex.debug.log(this.logPrefix,"_popupSelectAndClose"),this._promptEmptyMask(),this._promptEmptyTags(),this.element.val(null);for(var t=0;t<this.popup.state.selected.length;t++)this._maskStateSelectedAdd({display:this.popup.state.selected[t].display,value:this.popup.state.selected[t].value,isAPEXNullValue:this.popup.state.selected[t].isAPEXNullValue},!1,this.popup.state.selected[t].isExtraValue,this.popup.state.selected[t].isAPEXNullValue);this._promptApplyValues(!0),this.popup.state.selecting=!0,this._popupClose()},_popupClearFiltering:function(){apex.debug.log(this.logPrefix,"_popupClearFiltering"),this.popup.showSelectedCheckbox.is(":checked")?this._popupShowSelectedCheckboxChange():this._popupSearchClear(!0)},_popupSearchClear:function(t){apex.debug.log(this.logPrefix,"_popupSearchClear","force key up",t),this.popup.state.searchString=null,this.popup.search.val(null),t&&(this.popup.search.trigger("keyup"),this._popupAjaxPerform(1,this._popupOpenGetDefaultSortColumnIdx(),this._popupOpenGetDefaultSortColumnDirection()))},_popupNewOption:function(t,e){return $('<option value="'+t+'">'+e+"</option>")},_popupDebugStateObject:function(){for(var t in apex.debug.log(this.logPrefix,"_popupDebugStateObject",this.popup.state),this.popup.state)if(this.popup.state[t]instanceof Array){for(var e in apex.debug.log(this.logPrefix,"this.popup.state."+t+" ARRAY START"),this.popup.state[t])apex.debug.log(this.logPrefix,"this.popup.state."+t+"["+e+"]",this.popup.state[t][e]);apex.debug.log(this.logPrefix,"this.popup.state."+t+" ARRAY END")}else apex.debug.log(this.logPrefix,"this.popup.state."+t+' = "'+this.popup.state[t]+'"')},_popupClose:function(){apex.debug.log(this.logPrefix,"_popupClose"),this.popup.container.dialog("close"),this._triggerEvent("paeli_popup_hidden",this._popupGetEventData())},_popupGetEventData:function(){return{header:this.popup.header,container:this.popup.container,body:this.popup.body,footer:this.popup.footer,pagination:this.popup.pagination,search:this.popup.search,rowsPerPage:this.popup.rowsPerPage,contentTable:this.popup.contentTable,state:{selected:this.popup.state.selected,searchString:this.popup.state.searchString,searchColumnIdx:this.popup.state.searchColumnIdx,sortedColumnIdx:this.popup.state.sortedColumnIdx,sortedColumnDirection:this.popup.state.sortedColumnDirection,ajaxRunning:this.popup.state.ajaxRunning}}},_popupOpen:function(){apex.debug.log(this.logPrefix,"_popupOpen"),this.popup.body.empty(),this.popup.container.dialog("open")},_popupOpenByButton:function(t){apex.debug.log(this.logPrefix,"_popupOpenByButton"),t.preventDefault(),this.mask.state.disabled?apex.debug.log(this.logPrefix,"_popupOpenByButton","APEX item is disabled, do nothing."):this._popupOpen()},_popupCreatePaginationContainer:function(){apex.debug.log(this.logPrefix,"_popupCreatePaginationContainer");var t=$('<div class="paginationContainer"></div>'),e=$('<a href="javascript: void(0)" class="prev"><span class="fa fa-caret-left"></span> '+this.C_POPUP_PAGINATION_PREV+"</a>"),i=$('<span class="current">?</span>'),o=$('<a href="javascript: void(0)" class="next">'+this.C_POPUP_PAGINATION_NEXT+' <span class="fa fa-caret-right"></span></a>');return t.append(e).append(i).append(o),t},_popupCreateNew:function(){apex.debug.log(this.logPrefix,"_popupCreateNew");var t=$('<div class="header"></div>'),e=$('<div class="information hidden"> <div class="text"></div> </div>'),i=$('<div class="searchContainer"></div>'),o=$('<div class="rowsPerPageContainer"></div>'),p=$("<select></select"),s=$('<input type="text" placeholder="'+this.C_POPUP_SEARCH_PLACEHOLDER+'" class="empty">'),a=$('<span class="fa fa-search search"></span>'),n=$('<span class="fa fa-trash-o clear"></span>'),r=$('<div class="body"></div>'),l=$('<div class="footer"></div>'),u=$('<div class="footer-showSelected"></div>'),h=$('<div class="footer-buttons"></div>'),d=$('<button class="t-Button t-Button--icon t-Button--iconLeft t-Button--hot select"><span class="t-Icon t-Icon--left fa fa-check"></span><span class="t-Button-label">'+this.C_POPUP_BTN_SELECT_TEXT+"</span></button>"),g=$('<button class="t-Button debug"><span class="fa fa-info"></span></button>'),c=$('<input type="checkbox"><span class="fa fa-check-square-o fakeCheckbox"></span><span class="fa fa-square-o fakeCheckbox"></span>'),m=$("<label>"+this.C_POPUP_SHOW_SELECTED_LABEL+"</label>"),x=$('<div class="container" data-apex-item="'+this.element.get(0).id+'"></div>'),_={dialogClass:"pretius--enhancedLovItem "+(this.pluginSettings.popup.clickOnRowSelectsIt?"selectViaRows":""),autoOpen:!1,appendTo:"body",modal:!0,title:this.pluginSettings.popup.title,width:this.pluginSettings.popup.width,minWidth:500,height:this.pluginSettings.popup.adjustHeightToResults?500:this.pluginSettings.popup.height,minHeight:255,resizable:this.pluginSettings.popup.resizable,draggable:this.pluginSettings.popup.draggable,closeOnEscape:this.pluginSettings.popup.closeOnEscape,resizeStop:$.proxy(this._popupDialogResizeStopCallback,this),drag:$.proxy(this._popupDragPositionFixCallback,this),dragStart:$.proxy(this._popupDialogDragStartCallback,this),dragStop:$.proxy(this._popupDialogDragStopCallback,this),open:$.proxy(this._popupDialogOpenCallback,this),close:$.proxy(this._popupDialogCloseCallback,this),beforeClose:$.proxy(this._popupDialogBeforeCloseCallback,this)};if(x.dialog(_),this.pluginSettings.popup.searchInAllColumns&&(i.append(s).append(a).append(n),t.append(i)),this.pluginSettings.popup.showRowsPerPage){for(var f=1;f<=10;f++)p.append(this._popupNewOption(10*f,10*f));o.append(p),t.append(o)}return this.pluginSettings.popup.searchInAllColumns||this.pluginSettings.popup.showRowsPerPage||t.addClass("paginationOnly"),t.append(this._popupCreatePaginationContainer()),c.uniqueId(),m.attr("for",c.attr("id")),u.append(c).append(m),this.pluginSettings.isDebugOn&&(g.click($.proxy(this._popupDebugStateObject,this)),h.append(g)),h.append(d),l.append(u).append(h),x.append(t).append(e).append(r).append(l),x},_popupDialoginBtnClick:function(t){apex.debug.log(this.logPrefix,"_popupDialoginBtnClick")},_popupSearchInSelectedData:function(t,e,i,o){var p,s;apex.debug.log(this.logPrefix,"_popupSearchInSelectedData",this.popup.state.ajaxCurrentPageData),apex.debug.log(this.logPrefix,"_popupSearchInSelectedData",t,i,o),p=o?this.popup.state.ajaxSelectedData.filter((function(t){for(var e in t)if(t[e].toString().toUpperCase().indexOf(i.toUpperCase())>-1)return!0;return!1})):this.popup.state.ajaxSelectedData.filter((function(e){return e[t].toUpperCase().indexOf(i.toUpperCase())>-1})),apex.debug.log(this.logPrefix,"_popupSearchInSelectedData","filtered",p),this.popup.state.searchString=i,this.popup.state.searchColumnIdx=e,this.popup.state.ajaxCurrentPageData=p,this._popupReportRender({data:p}),s=this.C_POPUP_TEXT_SEACH_IN_SELECTED.replace("%0",p.length).replace("%1",this.popup.state.ajaxSelectedData.length),this._popupInformationAppend(s,this.C_POPUP_TEXT_SEACH_IN_SELECTED)},_popupSearchBlur:function(t){apex.debug.log(this.logPrefix,"_popupSearchBlur","pEvent",t),apex.debug.log(this.logPrefix,"_popupSearchBlur",'current value "'+this.popup.search.val()+'"'),apex.debug.log(this.logPrefix,"_popupSearchBlur",'focus value "'+this.popup.state.searchStringOnFocus+'"');var e=apex.jQuery.Event("keyup",{which:$.ui.keyCode.ENTER,keyCode:13});this.popup.search.val()!=this.popup.state.searchStringOnFocus&&this.popup.search.trigger(e)},_popupSearchFocus:function(t){apex.debug.log(this.logPrefix,"_popupSearchFocus",t),this.popup.state.searchStringOnFocus=this.popup.search.val(),apex.debug.log(this.logPrefix,"_popupSearchFocus",'current search string is "'+this.popup.state.searchStringOnFocus+'"')},_popupSearchKeyUp:function(t,e,i){apex.debug.log(this.logPrefix,"_popupSearchKeyUp",i.keyCode);var o=$(i.currentTarget).val(),p=i.currentTarget==this.popup.search.get(0);13==i.keyCode&&(this.popup.showSelectedCheckbox.is(":checked")?this._popupSearchInSelectedData(t,e,o,p):p?this._popupAjaxPerform(1,null,null,o):(this._popupAjaxPerform(1,this.popup.state.sortedColumnIdx,this.popup.state.sortedColumnDirection,o,e),this._popupSearchClear(!1),this._maskKeyUpManageIcons()))},_popupGetMaxDialogHeight:function(t){apex.debug.log(this.logPrefix,"_popupGetMaxDialogHeight","pReportHeight",t);this.popup.dialogHeader.outerHeight();var e=0;return e+=this.popup.dialogHeader.outerHeight(),this.popup.informationContainer.is(":visible")&&(e+=this.popup.informationContainer.outerHeight()),this.popup.header.is(":visible")&&(e+=this.popup.header.outerHeight()),this.popup.footer.is(":visible")&&(e+=this.popup.footer.outerHeight()),(e+=t)>$(window).outerHeight()&&(e=$(window).outerHeight()-40),apex.debug.log(this.logPrefix,"_popupGetMaxDialogHeight","returns",e),e},_popupGetMaxHeightReport:function(t){apex.debug.log(this.logPrefix,"_popupGetMaxHeightReport","pDialogTotalHeight",t);var e=t,i=null!=this.popup.contentTable?this.popup.contentTable.outerWidth():0;return e-=this.popup.dialogHeader.outerHeight(),this.popup.informationContainer.is(":visible")&&(e-=this.popup.informationContainer.outerHeight()),this.popup.header.is(":visible")&&(e-=this.popup.header.outerHeight()),this.popup.footer.is(":visible")&&(e-=this.popup.footer.outerHeight()),i>this.popup.body.outerWidth()&&(e+=17),apex.debug.log(this.logPrefix,"_popupGetMaxHeightReport","returns",e),e},_popupAdjustBodyHeightAnimate:function(t){apex.debug.log(this.logPrefix,"_popupAdjustBodyHeightAnimate","pDuration",t);var e=this._popupGetTableHeight();0!=e&&this.popup.body.stop().animate({maxHeight:e,minHeight:e},{duration:t?100:t,step:$.proxy((function(t,e){var i=0;i+=t,this.popup.informationContainer.is(":visible")&&(i+=this.popup.informationContainer.outerHeight()),this.popup.header.is(":visible")&&(i+=this.popup.header.outerHeight()),this.popup.footer.is(":visible")&&(i+=this.popup.footer.outerHeight()),i+=this.popup.dialogHeader.outerHeight(),this.popup.container.dialog("option","height",i)}),this),complete:$.proxy((function(){apex.debug.log(this.logPrefix,"_popupAdjustBodyHeightAnimate","animation completed")}),this)})},_popupGetTableHeight:function(){var t=0;return null!=this.popup.contentTable?(t=this.popup.contentTable.outerHeight(),apex.debug.log(this.logPrefix,"_popupGetTableHeight","tableHeight",t)):(t=this.popup.body.children().first().outerHeight(),apex.debug.log(this.logPrefix,"_popupGetTableHeight","tableHeight of children",t)),t=this._popupGetMaxHeightReport(this._popupGetMaxDialogHeight(t)),apex.debug.log(this.logPrefix,"_popupGetTableHeight returns",t),t},_popupAdjustBodyHeight:function(t){var e;apex.debug.log(this.logPrefix,"_popupAdjustBodyHeight"),this.pluginSettings.popup.adjustHeightToResults?this._popupAdjustBodyHeightAnimate(t):(e=this.popup.container.outerHeight(),e-=this.popup.informationContainer.is(":visible")?this.popup.informationContainer.outerHeight():0,e-=this.popup.header.is(":visible")?this.popup.header.outerHeight():0,e-=this.popup.footer.is(":visible")?this.popup.footer.outerHeight():0,this.popup.body.css("maxHeight",e),this.popup.body.css("minHeight",e))},_popupHighlightResults:function(t){apex.debug.log(this.logPrefix,"_popupHighlightResults");var e,i=this.popup.state.searchString,o=null!=i?i.split("%"):[];return apex.debug.log(this.logPrefix,"_popupHighlightResults",o),null==i||0==i.length||(null!=this.popup.state.searchColumnIdx?t.find("td:nth-child("+(this.popup.state.searchColumnIdx+1)+")"):t.find("td:not(:nth-child(1))")).each($.proxy((function(t,i){for(var p in e=$(i).text(),o)e=this._highlightWord(e,o[p]);$(i).html(e)}),this)),t},_popupShowSelectedCheckboxChange:function(){apex.debug.log(this.logPrefix,"_popupShowSelectedCheckboxChange"),0!=this.popup.state.selected.length?this.popup.showSelectedCheckbox.is(":checked")?this._popupAjaxGetOnlySelected():this._popupAjaxPerform(1,1,"asc",null,null):this.popup.showSelectedCheckbox.prop("checked",!1)},popupInformationHide:function(){apex.debug.log(this.logPrefix,"popupInformationHide"),this.popup.state.informationTemplate=void 0,this.popup.state.informationText=void 0,this.popup.informationContainer.addClass("hidden")},popupInformationShow:function(){apex.debug.log(this.logPrefix,"popupInformationShow"),this.popup.informationContainer.removeClass("hidden")},_popupInformationAppend:function(t,e){apex.debug.log(this.logPrefix,"_popupInformationAppend"),this.popup.informationText.empty().append(t),this.popupInformationShow(),this.popup.state.informationText=t,this.popup.state.informationTemplate=e},_popupThCheckboxChange:function(t){apex.debug.log(this.logPrefix,"_popupThCheckboxChange",t);var e,i=this.popup.contentTable.find("tr td:first-child :checkbox"),o=i.filter((function(){return $(this).is(":checked")})).toArray(),p=i.filter((function(){return $(this).is(":not(:checked)")})).toArray(),s=this.C_POPUP_TEXT_ROWS_SELECTED.replace("%0",i.length);if(this.popup.selectAllCheckbox.is(":checked")){for(e=0;e<p.length;e++)$(p[e]).trigger("click");this._popupInformationAppend(s,this.C_POPUP_TEXT_ROWS_SELECTED)}else for(this.popup.state.informationTemplate==this.C_POPUP_TEXT_ROWS_SELECTED&&this.popupInformationHide(),e=0;e<o.length;e++)$(o[e]).trigger("click");this._popupAdjustBodyHeight()},_popupToggleRowState:function(t){apex.debug.log(this.logPrefix,"_popupToggleRowState"),t instanceof jQuery==0&&(t=$(t)),t.is(":checked")?t.closest("tr").addClass("selected"):t.closest("tr").removeClass("selected")},_popupTdCheckboxChange:function(t){var e,i,o=$(t.currentTarget);t.stopImmediatePropagation(),apex.debug.log(this.logPrefix,"_popupTdCheckboxChange",o.get(0)),i=(e=this.popup.contentTable.find("tr td:first-child :checkbox")).filter((function(){return $(this).is(":checked")})),o.is(":checked")?this._popupSelectValue(o):(this._popupUnselectValue(o.val()),this.popup.showSelectedCheckbox.is(":checked")&&o.closest("tr").remove()),apex.debug.log(this.logPrefix,"_popupTdCheckboxChange","checkboxes cnt",e.length),apex.debug.log(this.logPrefix,"_popupTdCheckboxChange","checked checkboxes cnt",i.length),e.length==i.length?this.popup.selectAllCheckbox.is(":checked")||this.popup.selectAllCheckbox.prop("checked",!0):this.popup.selectAllCheckbox.prop("checked",!1),this._popupToggleRowState(o)},_popupTdRadioChange:function(t){apex.debug.log(this.logPrefix,"_popupTdRadioChange");var e=$(t.currentTarget);this.popup.container.find(".selected").removeClass("selected"),e.is(":checked")?(this._popupResetValues(),this._popupSelectValue(e)):(this._popupUnselectValue(checkbox.val()),this.popup.showSelectedCheckbox.is(":checked")&&e.closest("tr").remove()),this._popupToggleRowState(e)},_popupIsValueSelected:function(t){apex.debug.log(this.logPrefix,"_popupIsValueSelected",t);for(var e=0;e<this.popup.state.selected.length;e++)if(this.popup.state.selected[e].value==t)return apex.debug.log(this.logPrefix,"_popupIsValueSelected",t,!0),!0;return apex.debug.log(this.logPrefix,"_popupIsValueSelected",t,!1),!1},_popupValueSelectedIndex:function(t){apex.debug.log(this.logPrefix,"_popupValueSelectedIndex",t);for(var e=0;e<this.popup.state.selected.length;e++)if(this.popup.state.selected[e].value==t)return apex.debug.log(this.logPrefix,"_popupValueSelectedIndex",t,e),e;return apex.debug.log(this.logPrefix,"_popupValueSelectedIndex",t,-1),-1},_popupUnselectValue:function(t){apex.debug.log(this.logPrefix,"_popupUnselectValue");var e,i=this._popupValueSelectedIndex(t);i<0&&this._throwErrorText(' Value "'+t+'" is not selected!'),e=this.popup.state.selected.splice(i,1),apex.debug.log(this.logPrefix,"_popupUnselectValue","removed value",e),this._popupShowSelectedUpdate(!0)},_popupResetValues:function(){apex.debug.log(this.logPrefix,"_popupResetValues"),this.popup.state.selected=[]},_popupSelectValue:function(t){apex.debug.log(this.logPrefix,"_popupSelectValue");var e={display:t.attr("aria-display-value"),value:t.val(),isExtraValue:t.attr("aria-extra-value"),isAPEXNullValue:t.attr("aria-null-value")};this.popup.state.selected.push(e),this._popupShowSelectedUpdate(!1)},_popupShowSelectedUpdate:function(t){apex.debug.log(this.logPrefix,"_popupShowSelectedUpdate","perform ajax on 0 selected",t);var e=this.popup.state.selected.length;this.popup.showSelectedLabel.text(this.C_POPUP_SHOW_SELECTED_LABEL+" ("+e+")"),0==e?(this.popup.showSelectedContainer.addClass("inactive"),t&&this.popup.showSelectedCheckbox.is(":checked")&&this._popupAjaxPerform(1,this._popupOpenGetDefaultSortColumnIdx(),this._popupOpenGetDefaultSortColumnDirection()),this.popup.showSelectedCheckbox.prop("checked",!1)):this.popup.showSelectedContainer.removeClass("inactive")},_popupClickOnCell:function(t){apex.debug.log(this.logPrefix,"_popupClickOnCell",t);var e=$(t.target).closest("tr").find("td:first-child :input");e.is(":checkbox")?e.trigger("click"):(e.prop("checked",!0),e.trigger("change"))},_popupFakeRadioClick:function(t){apex.debug.log(this.logPrefix,"_popupFakeRadioClick");var e=$(t.currentTarget);t.stopImmediatePropagation(),e.parent().find(":radio").trigger("click")},_popupFakeCheckboxClick:function(t){apex.debug.log(this.logPrefix,"_popupFakeCheckboxClick");var e=$(t.currentTarget);t.stopImmediatePropagation(),e.parent().find(":checkbox").trigger("click")},_popupSortReport:function(t,e,i){apex.debug.log(this.logPrefix,"_popupSortReport","pColumnIdx",e,"pSortDirection",i);var o=this.popup.state.searchString,p=this.popup.state.searchColumnIdx;this.popup.showSelectedCheckbox.is(":checked")?(this.popup.state.ajaxCurrentPageData.sort(this._sortJson(t,i)),this.popup.state.sortedColumnDirection=i,this.popup.state.sortedColumnIdx=e,this._popupReportRender({data:this.popup.state.ajaxCurrentPageData})):this._popupAjaxPerform(1,e,i,o,p)},_popupGetHeadings:function(){apex.debug.log(this.logPrefix,"_popupGetHeadings");var t,e,i,o,p,s,a=$("<thead><tr></tr></thead>"),n=$('<th class="t-Report-colHead"></th>'),r=$('<input type="checkbox"><span class="fa fa-check-square-o fakeCheckbox"></span><span class="fa fa-square-o fakeCheckbox"></span>');this.pluginSettings.isMultipleSelection&&n.append(r),a.find("tr").append(n);for(var l=0;l<this.options.columns.length;l++)t=this.options.columns[l].COLUMN_NAME,e=this.options.columns[l].IDX,column_alias=this._popupColumnIsConfigurationAvailable(t,"heading"),this.pluginSettings.popup.isReportAdvancedConf&&!this._popupColumnIsDefined(t)||this._popupColumnIsConfigurationAvailable(t,"visible")&&(this.pluginSettings.popup.isReportBasicConf&&0==this.pluginSettings.popup.isReturnColumnVisible&&"R"==t||this.pluginSettings.popup.isReportBasicConf&&0==this.pluginSettings.popup.isDisplayColumnVisible&&"D"==t||(this.popup.state.sortedColumnIdx==e?"asc"==this.popup.state.sortedColumnDirection?(i='<span class="u-Report-sortIcon a-Icon icon-rpt-sort-asc"></span>',p="desc"):(i='<span class="u-Report-sortIcon a-Icon icon-rpt-sort-desc"></span>',p="asc"):(i="",p="asc"),o=this.popup.state.searchColumnIdx==e?'<span class="u-Report-sortIcon fa fa-filter"></span>':"",s=this._popupColumnIsConfigurationAvailable(t,"thAlign"),th='<th class="t-Report-colHead" align="'+s+'" aria-column-name="'+t+'">  <div class="u-Report-sort">    <span class="u-Report-sortHeading">      <a href="javascript: void(0)">'+column_alias+"</a>    </span>    "+i+"    "+o+"  </div></th>",th=$(th),apex.debug.log(this.logPrefix,"_popupGetHeadings filtering or sorting available, bind click callback"),th.bind("click",$.proxy(this._popupReportHeaderClickCallback,this,this.options.columns[l],p)),a.find("tr").append(th)));return a},_popupReportHeaderContainerCreate:function(t,e){apex.debug.log(this.logPrefix,"_popupReportHeaderContainerCreate","pCurrentTh",t),apex.debug.log(this.logPrefix,"_popupReportHeaderContainerCreate","pColumnObject",e);t.text().trim();var i=$('<div class="columnOperations"><div class="sorting"></div><div class="filtering"></div></div>'),o=$('<a href="javascript: void(0)" title="'+this.C_POPUP_HEADER_SORT_ASC_TITLE+'"><span class="a-Icon icon-irr-sort-asc"></span></a>'),p=$('<a href="javascript: void(0)" title="'+this.C_POPUP_HEADER_SORT_DESC_TITLE+'"><span class="a-Icon icon-irr-sort-desc"></span></a>'),s=$('<div><span class="fa fa-search search"></span><span class="fa fa-trash-o clear"></span></div>'),a=$('<input type="text" class="empty">'),n=t.attr("aria-column-name");return s.find(".clear").bind("click",$.proxy(this._headerWidgetClearFiltering,this)),this._popupColumnIsConfigurationAvailable(e.COLUMN_NAME,"sort")&&(o.bind("click",$.proxy(this._popupSortReport,this,n,e.IDX,"asc")),p.bind("click",$.proxy(this._popupSortReport,this,n,e.IDX,"desc")),i.find(".sorting").append(o).append(p)),this._popupColumnIsConfigurationAvailable(e.COLUMN_NAME,"filter")&&(a.on("keyup",this._debounce($.proxy(this._popupSearchKeyUp,this,n,e.IDX),this.pluginSettings.popupSearchDebounceTime)).on("keyup",$.proxy(this._headerWidgetKeyUpManageIcons,this)),null!=this.popup.state.searchString&&e.IDX==this.popup.state.searchColumnIdx&&(a.val(this.popup.state.searchString),a.removeClass("empty")),i.find(".filtering").append(a).append(s)),i.find(".heading").css("maxWidth",t.outerWidth()),i.css({minWidth:t.outerWidth(),left:t.position().left,top:t.outerHeight()}),i.find(".heading").css("padding",t.css("padding")),i},_popupReportHeaderWidgetHide:function(){apex.debug.log(this.logPrefix,"_popupReportHeaderWidgetHide"),this.popup.stickyHeaders.find("th").removeClass("is-active"),this.popup.headerActionContainer.remove(),this.popup.headerActionContainer=void 0,$(document).off("click.pretius--enhancedLovItem")},_popupReportHeaderWidgetShow:function(t,e){apex.debug.log(this.logPrefix,"_popupReportHeaderWidgetShow"),null!=this.popup.headerActionContainer&&this._popupReportHeaderWidgetHide(),t.addClass("is-active"),this.popup.headerActionContainer=e,this.popup.body.append(e),e.find(":input").focus()},_popupReportHeaderClickCallback:function(t,e,i){i.stopImmediatePropagation(),apex.debug.log(this.logPrefix,"_popupReportHeaderClickCallback",i),apex.debug.log(this.logPrefix,"_popupReportHeaderClickCallback column data",{"column object":t,sort_direction:e});var o=$(i.currentTarget),p=this._popupReportHeaderContainerCreate(o,t);this._popupReportHeaderWidgetShow(o,p),$(document).bind("click.pretius--enhancedLovItem",$.proxy(this._popupReportHeaderClickOutsideCheck,this))},_popupReportHeaderClickOutsideCheck:function(t){apex.debug.log(this.logPrefix,"_popupReportHeaderClickOutsideCheck",t);var e=$(t.target);$.contains(this.popup.headerActionContainer.get(0),e.get(0))?apex.debug.log(this.logPrefix,"_popupReportHeaderClickOutsideCheck","clicked inside header widget"):(apex.debug.log(this.logPrefix,"_popupReportHeaderClickOutsideCheck","clicked outside header widget"),this._popupReportHeaderWidgetHide())},_popupCreateStickyHeaders:function(){apex.debug.log(this.logPrefix,"_popupCreateStickyHeaders");var t=$("<table></table>"),e=this.popup.body.find(".report thead").clone(!0,!0),i=this.popup.body.find("table th");null!=this.popup.stickyHeaders&&(this.popup.stickyHeaders.remove(),apex.debug.log(this.logPrefix,"_popupCreateStickyHeaders","removing existing stickyHeaders")),e.find("th").each((function(t,e){$(e).css({minWidth:i.eq(t).outerWidth(),maxWidth:i.eq(t).outerWidth(),width:i.eq(t).outerWidth()}),i.eq(t).css({minWidth:i.eq(t).outerWidth(),maxWidth:i.eq(t).outerWidth(),width:i.eq(t).outerWidth()})})),t.addClass("t-Report-report stickyHeaders").attr("summary",this.pluginSettings.popup.title).css("top",0).append(e),this.popup.stickyHeaders=t,this.popup.selectAllCheckbox=this.popup.stickyHeaders.find("th:first-child :checkbox"),this.popup.body.append(t)},_popupReportRenderSearching:function(){apex.debug.log(this.logPrefix,"_popupReportRenderSearching");var t=this.popup.state.searchString,e=this.C_POPUP_TEXT_SEARCHING.replace("%0",t),i=$('                                 <div class="searchingForResults">              <div class="icon">                             <span class="fa fa-refresh fa-anim-spin"></span>   </div>                                       <div class="text">'+e+"</div></div>                                       ");this.popup.body.empty().append(i),this._popupHeaderHide(),this._popupFooterHide(),this.popupInformationHide(),this._popupAdjustBodyHeight()},_popupReportRenderNodataFound:function(){apex.debug.log(this.logPrefix,"_popupReportRenderNodataFound");var t,e=this.popup.state.searchString,i=$('                                 <div class="nodatafoundContainer">             <div class="icon">                             <span class="fa fa-table-search"></span>   </div>                                       <div class="text">#TEXT#</div></div>                                       ');t=null==e?this.C_POPUP_TEXT_NO_DATA_FOUND_QUERY:this.C_POPUP_TEXT_NO_DATA_FOUND_SEARCH.replace("%0",e)+"</br>"+this.C_POPUP_TEXT_CLEAR_FILTERING,i.find(".text").html(t),this.popup.body.empty().append(i),this._popupPaginationHide(),this._popupRowsPerPageHide(),this._popupAdjustBodyHeight()},_popupReportBodyGet:function(t){apex.debug.log(this.logPrefix,"_popupReportBodyGet",t);var e,i='{{#data}}<tr {{#extra}}class="extraValue"{{/extra}} {{#isAPEXNullValue}}class="nullValue"{{/isAPEXNullValue}}>';i+='<td class="t-Report-cell">'+(this.pluginSettings.isMultipleSelection?'<input type="checkbox" value="{{{R}}}" {{#selected}}checked="true"{{/selected}} {{#extra}}aria-extra-value="true"{{/extra}} {{#isAPEXNullValue}}aria-null-value="true"{{/isAPEXNullValue}} aria-display-value="{{{D}}}" name="multiple">  <span class="fa fa-check-square-o fakeCheckbox"></span>  <span class="fa fa-square-o fakeCheckbox"></span>':'<input type="radio" value="{{{R}}}" {{#selected}}checked="true"{{/selected}} aria-display-value="{{{D}}}" {{#extra}}aria-extra-value="true"{{/extra}} {{#isAPEXNullValue}}aria-null-value="true"{{/isAPEXNullValue}} name="single">  <span class="fa fa-dot-circle-o fakeRadio"></span>  <span class="fa fa-circle-o fakeRadio"></span>')+"</td>";for(var o=0;o<this.options.columns.length;o++)e=this.options.columns[o].COLUMN_NAME,this.pluginSettings.popup.isReportAdvancedConf&&!this._popupColumnIsDefined(e)||this._popupColumnIsConfigurationAvailable(e,"visible")&&(this.pluginSettings.popup.isReportBasicConf&&0==this.pluginSettings.popup.isReturnColumnVisible&&"R"==e||this.pluginSettings.popup.isReportBasicConf&&0==this.pluginSettings.popup.isDisplayColumnVisible&&"D"==e||(tdAlign=this._popupColumnIsConfigurationAvailable(e,"tdAlign"),i+='<td class="t-Report-cell" align="'+tdAlign+'" headers="'+e+'">{{{'+e+"}}}</td>"));i+="</tr>{{/data}}";try{rendered=$(Mustache.render(i,t))}catch(t){this._throwError(t)}return this.popup.state.searchString&&(rendered=this._popupHighlightResults(rendered)),rendered=this._popupMarkAsExtraValue(rendered),rendered=this._popupMarkAsNullValue(rendered),rendered},_popupMarkAsNullValue:function(t){apex.debug.log(this.logPrefix,"_popupMarkAsNullValue",t);var e=t.find("td").length;return t.each($.proxy((function(t,e,i){var o=$(i),p=(o.find(":input").val(),o.find(":input").attr("aria-display-value"));o.is(".nullValue")&&(o.find("td").not(":first-child").remove(),o.append('<td class="t-Report-cell" colspan="'+(t-1)+'">'+p+"</td>"))}),this,e)),t},_popupMarkAsExtraValue:function(t){apex.debug.log(this.logPrefix,"_popupMarkAsExtraValue",t);var e=this.C_POPUP_TEXT_EXTRA_VALUE;return tdCnt=t.find("td").length,t.each($.proxy((function(t,e,i,o){var p=$(o),s=p.find(":input").val(),a=e.replace("%0",s);p.is(".extraValue")&&(p.find("td").not(":first-child").remove(),p.append('<td class="t-Report-cell" colspan="'+(t-1)+'">'+a+"</td>"))}),this,tdCnt,e)),t},_popupReportRender:function(t){apex.debug.log(this.logPrefix,"_popupReportRender",t);var e,i=$("<div></div>"),o=$("<table></table>"),p=$("<tbody></tbody>"),s=0;if(0==t.data.length)return apex.debug.log(this.logPrefix,"_popupReportRender","no rows to render, display no data found"),this.popup.body.addClass("nodatafound"),void this._popupReportRenderNodataFound();e=this._popupGetHeadings(),o.addClass("t-Report-report report").attr("summary",this.pluginSettings.popup.title).append(e).append(p.append(this._popupReportBodyGet(t))),i.addClass("t-Report t-Report--altRowsDefault t-Report--rowHighlight t-Report--stretch").append(o),this.popup.contentTable=o,this.popup.body.removeClass("nodatafound").removeClass("searching").empty().append(i).scrollTop(0),this.pluginSettings.isMultipleSelection?p.find("td:first-child :checkbox:checked").each($.proxy((function(t,e){s++,this._popupToggleRowState(e)}),this)):p.find("td:first-child :radio:checked").each($.proxy((function(t,e){this._popupToggleRowState(e)}),this)),this._popupPaginationUpdate(),this._popupHeaderShow(),this._popupFooterShow(),this._popupAdjustBodyHeight(),this._popupCreateStickyHeaders(),this.popup.search.focus(),this.pluginSettings.isMultipleSelection&&(t.data.length==s?(apex.debug.log(this.logPrefix,"_popupReportRender ajax data length match selected rows"),this.popup.selectAllCheckbox.prop("checked",!0)):apex.debug.log(this.logPrefix,"_popupReportRender ajax data length doesn't match selected rows",'ajax data length = "'+t.data.length+'"','selected rows = "'+s+'"')),this._triggerEvent("paeli_popup_data_rendered",this._popupGetEventData())},_popupGetRowsPerPage:function(){apex.debug.log(this.logPrefix,"_popupGetRowsPerPage");var t=this.popup.rowsPerPage.val();return"%"==t||null==t?this.pluginSettings.popup.rowsPerPage:t},_popupChangeRowsPerPage:function(){apex.debug.log(this.logPrefix,"_popupChangeRowsPerPage");var t=this.popup.state.searchString;this.popup.state.searchColumnIdx;this._popupAjaxPerform(1,this.popup.state.sortedColumnIdx,this.popup.state.sortedColumnDirection,t,this.popup.state.searchColumnIdx)},_popupHeaderHide:function(){apex.debug.log(this.logPrefix,"_popupHeaderHide",this.popup.header),this.popup.header.addClass("hidden")},_popupHeaderShow:function(){apex.debug.log(this.logPrefix,"_popupHeaderShow"),this.popup.header.removeClass("hidden")},_popupFooterHide:function(){apex.debug.log(this.logPrefix,"_popupFooterHide"),this.popup.footer.addClass("hidden")},_popupFooterShow:function(){apex.debug.log(this.logPrefix,"_popupFooterShow"),this.popup.footer.removeClass("hidden")},_popupRowsPerPageHide:function(){apex.debug.log(this.logPrefix,"_popupRowsPerPageHide"),this.popup.rowsPerPageContainer.hide()},_popupRowsPerPageShow:function(){apex.debug.log(this.logPrefix,"_popupRowsPerPageShow"),this.popup.rowsPerPageContainer.show()},_popupPaginationHide:function(){apex.debug.log(this.logPrefix,"_popupPaginationHide"),this.popup.paginationContainer.hide()},_popupPaginationShow:function(){apex.debug.log(this.logPrefix,"_popupPaginationShow"),this.popup.paginationContainer.show()},_popupPaginationPrevPage:function(){apex.debug.log(this.logPrefix,"_popupPaginationPrevPage"),this._popupAjaxPerform(--this.popup.state.lastFetchedPage,this.popup.state.sortedColumnIdx,this.popup.state.sortedColumnDirection,this.popup.state.searchString,this.popup.state.searchColumnIdx)},_popupPaginationNextPage:function(){apex.debug.log(this.logPrefix,"_popupPaginationNextPage"),this._popupAjaxPerform(++this.popup.state.lastFetchedPage,this.popup.state.sortedColumnIdx,this.popup.state.sortedColumnDirection,this.popup.state.searchString,this.popup.state.searchColumnIdx)},_popupPaginationUpdate:function(){apex.debug.log(this.logPrefix,"_popupPaginationUpdate");var t=this.popup.state.ajaxCurrentPageRownumStart,e=this.popup.state.ajaxCurrentPageRownumEnd,i=this.popup.state.ajaxDataTotalCount,o="%0 - %1 %2 %3";e=e>i?i:e,o=o.replace("%0",t).replace("%1",e).replace("%2",this.C_PAGINATION_TEXT_OF_NBR_RECORD).replace("%3",i),this.popup.paginationCurrent.text(o),1==this.popup.state.lastFetchedPage?this.popup.paginationPrevPage.hide():this.popup.paginationPrevPage.show(),e==i?this.popup.paginationNextPage.hide():this.popup.paginationNextPage.show()},_popupIsFiltered:function(){return apex.debug.log(this.logPrefix,"_popupIsFiltered"),null!=this.popup.state.searchString&&this.popup.state.searchString.length>0},_popupScrollCallback:function(t){apex.debug.log(this.logPrefix,"_popupScrollCallback");this._getScrollPercent($(t.currentTarget),$(t.currentTarget).outerHeight()),this.popup.state.sortedColumnIdx,this.popup.state.sortedColumnDirection,this.popup.state.searchString,this.popup.state.searchColumnIdx;var e=$(t.currentTarget).scrollTop();this.popup.state.ajaxStatus!=this.C_AJAX_STATUS_ERROR&&(this.popup.stickyHeaders.css("top",e),null!=this.popup.headerActionContainer&&this.popup.headerActionContainer.css("top",e+this.popup.body.find("th").first().outerHeight()))},_popupDragPositionFixCallback:function(t,e){apex.debug.log(this.logPrefix,"_popupDragPositionFixCallback");var i,o=$(document).scrollTop();o>0&&((i=e.position).top=i.top-o,this.popup.container.parent().closest(".ui-dialog").css("top",i.top+"px"))},_popupDialogDragStartCallback:function(t,e){apex.debug.log(this.logPrefix,"_popupDialogDragStartCallback"),null!=this.popup.headerActionContainer&&this.popup.headerActionContainer.hide()},_popupDialogDragStopCallback:function(t,e){apex.debug.log(this.logPrefix,"_popupDialogDragStopCallback"),null!=this.popup.headerActionContainer&&this.popup.headerActionContainer.show()},_popupDialogResizeStopCallback:function(){apex.debug.log(this.logPrefix,"_popupDialogResizeStopCallback"),this._popupAdjustBodyHeight()},_popupColumnIsDefined:function(t){var e=!1;return null!=this.popup.headers&&null!=this.popup.headers.columns&&null!=this.popup.headers.columns[t]?(apex.debug.log(this.logPrefix,"_popupColumnIsDefined",'Column "'+t+'" is defined.'),e=!0):(apex.debug.log(this.logPrefix,"_popupColumnIsDefined",'Column "'+t+'" is not defined.'),e=!1),e},_popupColumnIsConfigurationAvailable:function(t,e){var i;return 1==this.pluginSettings.popup.isReportAdvancedConf&&null!=this.popup.headers&&null!=this.popup.headers.columns&&null!=this.popup.headers.columns[t]&&null!=this.popup.headers.columns[t][e]?(i=this.popup.headers.columns[t][e],apex.debug.log(this.logPrefix,"_popupColumnIsConfigurationAvailable",'Column "'+t+'": attr "'+e+'" = "'+i+'"'),i):(i="heading"==e?t:this.popup.defaultReportSettings[e],apex.debug.log(this.logPrefix,"_popupColumnIsConfigurationAvailable",'Column "'+t+'": default attr "'+e+'" = "'+i+'"'),i)},_popupOpenGetDefaultSortColumnIdx:function(){apex.debug.log(this.logPrefix,"_popupOpenGetDefaultSortColumnIdx");var t,e=1;return this.pluginSettings.popup.isReportAdvancedConf&&null!=this.popup.headers&&null!=this.popup.headers.defaultSort&&null!=this.popup.headers.defaultSort.column&&null!=this.popup.headers.defaultSort.direction?(t=this.popup.headers.defaultSort.column,apex.debug.log(this.logPrefix,'_popupOpenGetDefaultSortColumnIdx defaultSort by column "'+t+'"'),e=this._getColumnIdxByColumnName(t)):(apex.debug.log(this.logPrefix,"_popupOpenGetDefaultSortColumnIdx defaultSort configuration is not defined, sort by 1st column."),e=1),apex.debug.log(this.logPrefix,'_popupOpenGetDefaultSortColumnIdx return "'+e+'"'),e},_popupOpenGetDefaultSortColumnDirection:function(){apex.debug.log(this.logPrefix,"_popupOpenGetDefaultSortColumnDirection");var t,e="asc";return this.pluginSettings.popup.isReportAdvancedConf&&null!=this.popup.headers&&null!=this.popup.headers.defaultSort&&null!=this.popup.headers.defaultSort.column&&null!=this.popup.headers.defaultSort.direction?(t=this.popup.headers.defaultSort.direction,apex.debug.log(this.logPrefix,'_popupOpenGetDefaultSortColumnDirection defaultSort direction defined as "'+t+'".'),e=this.popup.headers.defaultSort.direction):(apex.debug.log(this.logPrefix,"_popupOpenGetDefaultSortColumnDirection defaultSort configuration is not defined, sort direction asc."),e="asc"),apex.debug.log(this.logPrefix,'_popupOpenGetDefaultSortColumnDirection return "'+e+'"'),e},_popupDialogOpenCallback:function(){apex.debug.log(this.logPrefix,"_popupDialogOpenCallback"),this.popup.state.isVisible=!0,this.popup.state.selected=[],$("body").addClass("apex-no-scroll");for(var t=0;t<this.mask.state.selected.length;t++)this.popup.state.selected.push({display:this.mask.state.selected[t].display,value:this.mask.state.selected[t].value,isAPEXNullValue:this.mask.state.selected[t].isAPEXNullValue});this.popup.state.selectedHash=this._popupGetSelectedHash(),apex.debug.log(this.logPrefix,'_popupDialogOpenCallback hash "'+this.popup.state.selectedHash+'"'),this.popup.showSelectedCheckbox.is(":checked")?this._popupAjaxGetOnlySelected():null==this.popup.state.lastFetchedPage?this._popupAjaxPerform(1,this._popupOpenGetDefaultSortColumnIdx(),this._popupOpenGetDefaultSortColumnDirection()):this._popupAjaxPerform(this.popup.state.lastFetchedPage,this.popup.state.sortedColumnIdx,this.popup.state.sortedColumnDirection),this._popupShowSelectedUpdate(!1),this._triggerEvent("paeli_popup_shown",this._popupGetEventData())},_popupDialogCloseCallback:function(){apex.debug.log(this.logPrefix,"_popupDialogCloseCallback"),this.popup.state.isVisible=!1,this.popup.showSelectedCheckbox.prop("checked",!1),$("body").removeClass("apex-no-scroll")},_headerWidgetClearFiltering:function(t){apex.debug.log(this.logPrefix,"_headerWidgetClearFiltering"),this.popup.state.searchColumnIdx=void 0,this.popup.showSelectedCheckbox.is(":checked")?this._popupAjaxGetOnlySelected():null!=this.popup.state.sortedColumnIdx?this._popupAjaxPerform(1,this.popup.state.sortedColumnIdx,this.popup.state.sortedColumnDirection,null,null):this._popupAjaxPerform(1,this._popupOpenGetDefaultSortColumnIdx(),this._popupOpenGetDefaultSortColumnDirection())},_headerWidgetKeyUpManageIcons:function(t){apex.debug.log(this.logPrefix,"_headerWidgetKeyUpManageIcons",t);var e=$(t.currentTarget);0==e.val().length?e.addClass("empty"):e.removeClass("empty")},_promptReposition:function(){apex.debug.log(this.logPrefix,"_promptReposition");var t,e=this.mask.container.offset(),i=$(window).outerWidth(),o=e.top+this.mask.container.outerHeight()-1,p=e.left;this.prompt.isVisible?(this.prompt.container.css({top:o,left:p}),(t=this.prompt.container.outerWidth())+p>i&&(this.prompt.container.css({minWidth:t,left:"",right:i-this.mask.container.outerWidth()-p}),this.prompt.fixBorder.css({right:"auto",left:0}))):apex.debug.log(this.logPrefix,"_promptReposition prompt not visible, do nth.")},_promptCreateNew:function(){apex.debug.log(this.logPrefix,"_promptCreateNew");var t=this.element.get(0).attributes,e=null!=t.class?t.class.value.split(" "):[],i=$('<div class="fixBorder"></div>'),o=$("<div></div>"),p=$("<div></div>"),s=$('<div class="menu"></div>'),a=$('<a href="javascript: void(0)" class="t-Button t-Button--tiny t-Button--link t-Button--pill view" title="'+this.C_PROMPT_MENU_EXPAND_TITLE+'">  <span aria-hidden="true" class="fa fa-compress collapsed"></span>  <span aria-hidden="true" class="fa fa-expand expanded"></span></a>'),n=$('<a href="javascript: void(0)" class="t-Button t-Button--tiny t-Button--link t-Button--pill sort" title="'+this.C_PROMPT_MENU_SORT_TITLE+'">  <span aria-hidden="true" class="a-Icon icon-rpt-sort-asc asc"></span>  <span aria-hidden="true" class="a-Icon icon-rpt-sort-desc desc"></span></a>'),r=$('<a href="javascript: void(0)" class="t-Button t-Button--tiny t-Button--link t-Button--pill" title="'+this.C_PROMPT_MENU_CLEAR_TITLE+'">  <span aria-hidden="true" class="fa fa-trash-o clear"></span></a>'),l=$('<input type="text" tabindex="0">'),u=$('<span class="fa fa-search"></span>'),h=$("<div>\x3c!--default body--\x3e</div>"),d=this.mask.container.offset();for(var g in this.mask.container.is(".expanded")&&a.addClass("expanded"),null==this.mask.state.sorted||"asc"==this.mask.state.sorted?n.addClass("asc"):n.addClass("desc"),s.append(a).append(n).append(r),o.addClass("pretius--enhancedLovItem prompt").css({minWidth:this.mask.container.outerWidth(),borderColor:this.inputCss.borderColor,fontSize:this.inputCss.fontSize,lineHeight:this.inputCss.lineHeight}).append(i.css("borderColor",this.inputCss.borderColor)),apex.debug.log(this.logPrefix,"_promptCreateNew","offset",d),h.addClass("body").css({maxHeight:this.pluginSettings.prompt.maxHeight}),null!=t.maxlength&&l.attr("maxlength",t.maxlength.value),null!=t.placeholder&&l.attr("placeholder",t.placeholder.value),e)l.addClass(e[g]+"-input");l.attr("autocomplete","off"),p.addClass("header").append(l).append(u),this.pluginSettings.isMultipleSelection&&o.append(s),o.append(p).append(h),$.extend(this.prompt,{container:o,header:p,body:h,input:l,icon:u,fixBorder:i,menu:{container:s,expand:a,sort:n,clear:r}})},_promptShow:function(){apex.debug.log(this.logPrefix,"_promptShow"),$(document).on("click.promptcheck-"+this.element.get(0).id,$.proxy(this._promptCheckClickOutside,this)),this.prompt.input.focus(),this.mask.container.addClass("focused"),this.prompt.isVisible=!0,$("body").prepend(this.prompt.container),this._maskPopupButtonHide(),this._promptReposition(),this.mask.state.error&&0==this.pluginStopped&&(this.mask.ajaxStateButton.button.hide(),this.mask.state.error=!1),this._triggerEvent("paeli_prompt_shown",this._promptGetEventData())},_promptHide:function(t){apex.debug.log(this.logPrefix,"_promptHide","pFocusOnElement",t),this.mask.container.removeClass("focused"),this.prompt.container.remove(),this.prompt.container=void 0,this.prompt.isVisible=!1,this._maskPopupButtonShow(),null!=t&&t.is(":focusable")?t.focus():this._getNextFocusAble().focus(),this._triggerEvent("paeli_prompt_hidden",this._promptGetEventData()),$(document).off("click.promptcheck-"+this.element.get(0).id)},_promptAjaxPerform:function(t){apex.debug.log(this.logPrefix,"_promptAjaxPerform");var e=null==t?1:t,i=null==this.options.item.lov_cascade_parent_items||null==this.options.item.lov_cascade_parent_items?"":"#"+this.options.item.lov_cascade_parent_items,o={x01:"AUTOCOMPLETE",x02:this.pluginSettings.prompt.rowsPerPage,x03:this._maskGetValue(),x04:e,pageitems:i},p={beforeSend:$.proxy(this._promptAjaxBeforeSend,this,e),success:$.proxy(this._promptAjaxSuccess,this),error:$.proxy(this._promptAjaxError,this),complete:$.proxy(this._promptAjaxComplete,this)};this.mask.state.ajaxRunning&&(this.mask.state.xhr.abort(),this.mask.state.ajaxRunning=!1,this.prompt.icon.removeAttr("class").addClass("fa fa-search")),this.mask.state.xhr=apex.server.plugin(this.options.plugin.ajaxIdentifier,o,p)},_promptAjaxBeforeSend:function(t,e,i){apex.debug.log(this.logPrefix,"_promptAjaxBeforeSend",e,i,t);var o='<div class="searching">  <span class="text">'+this.C_PROMPT_TEXT_SEARCHING+"</span></div>";this.mask.state.ajaxRunning=!0,this.mask.state.areResultsAvailable=!1,null==this.prompt.container&&(this._promptCreateNew(),this._promptAddListeners(),this._promptShow()),1==t&&this.prompt.body.html(o),this.prompt.icon.removeAttr("class").addClass("fa fa-anim-spin fa-refresh")},_promptAfterRenderingData:function(){apex.debug.log(this.logPrefix,"_promptAfterRenderingData");var t=this.prompt.body.find("li").length,e=$('<div class="loadMore"><a href="javascript: void(0)">'+this.C_PROMPT_TEXT_LOAD_MORE+"</a></div>"),i=this.prompt.body.find(".loadMore").length>0;e.find("a").on("click",$.proxy((function(){this._promptAjaxPerform(++this.mask.state.lastFetchedPage)}),this)),e.css("borderColor",this.inputCss.borderColor),this.prompt.body.outerHeight()<this.pluginSettings.prompt.maxHeight&&t<this.mask.state.totalCount?0==i&&this.prompt.body.append(e):this.prompt.body.find(".loadMore").remove()},_promptAjaxSuccess:function(t,e,i){apex.debug.log(this.logPrefix,"_ajaxSuccess","pData",t),apex.debug.log(this.logPrefix,"_ajaxSuccess","pTextStatus",e),apex.debug.log(this.logPrefix,"_ajaxSuccess","pJqXHR",i),this.mask.state.totalCount=t.dataVolume[0].CNT,this.mask.state.lastFetchedPage=t.requestedPage,this.mask.state.areResultsAvailable=!0,this.prompt.icon.removeAttr("class").addClass("fa fa-search"),t=this._dataExtendSelectedFromArrayOfObjects(t,this.mask.state.selected),this.mask.state.lastFetchedPage>1?this._promptAppendData(t):(0!=this._maskGetValue().length||null==this.options.item.lov_null_text&&null==this.options.item.lov_null_value||t.data.unshift({R:this.options.item.lov_null_value,D:this.options.item.lov_null_text,isAPEXNullValue:!0}),this._promptRenderData(t)),this._promptAfterRenderingData(),null!=t.query&&this._writeQueryToConsole(t.query)},_promptAjaxError:function(t,e,i){(apex.debug.log(this.logPrefix,"_promptAjaxError","pJqXHR",t,"pTextStatus",e,"pErrorThrown",i),"abort"!=t.statusText)?(this._promptHide(this.mask.itemContainer),this._maskAjaxStateButtonSetError({addInfo:t.responseJSON.addInfo,error:t.responseJSON.error,techInfo:t.responseJSON.techInfo}),this._maskAjaxStateButtonError(),this._triggerEvent("paeli_prompt_error",this._promptGetEventData()),this._throwErrorText(i)):apex.debug.log(this.logPrefix,"_promptAjaxError","AJAX call aborted!")},_promptGetEventData:function(){return{prompt:{container:this.prompt.container,header:this.prompt.header,body:this.prompt.body,input:this.prompt.input},mask:{selected:this.mask.state.selected,dataAvailable:this.mask.state.areResultsAvailable}}},_promptAjaxComplete:function(){apex.debug.log(this.logPrefix,"_promptAjaxComplete"),this.mask.state.ajaxRunning=!1,this._promptCheckWidthDifference()},_promptCheckWidthDifference:function(){var t;apex.debug.log(this.logPrefix,"_promptCheckWidthDifference"),this.prompt.isVisible?(t=this.prompt.container.outerWidth()-this.mask.container.outerWidth())>0?(this.prompt.fixBorder.css("width",t+1),this.prompt.fixBorder.show()):this.prompt.fixBorder.hide():apex.debug.log(this.logPrefix,"_promptCheckWidthDifference prompt not visible, do nth")},_promptAjaxAbort:function(){apex.debug.log(this.logPrefix,"_promptAjaxAbort"),this.mask.state.xhr.abort(),this.mask.state.ajaxRunning=!1},_promptAddListeners:function(){apex.debug.log(this.logPrefix,"_promptAddListeners"),this.prompt.body.on("click","li",$.proxy(this._promptLiClickHanlder,this)).on("scroll",this._debounce($.proxy(this._promptScrollCallback,this),100)).on("mouseenter","li",$.proxy(this._promptUnhighlightOther,this)),this.prompt.input.on("blur",$.proxy(this._promptInputBlur,this)).on("focus",$.proxy(this._promptInputFocus,this)).on("keyup",this._debounce($.proxy(this._maskKeyUp,this),this.pluginSettings.prompt.debounceTime)).on("keydown",this._debounce($.proxy(this._promptInputKeyDownHandler,this),this.pluginSettings.prompt.navigationDebounceTime)),this.prompt.menu.expand.on("click",$.proxy(this._promptMenuChangeView,this)),this.prompt.menu.sort.on("click",$.proxy(this._promptMenuSortTags,this)),this.prompt.menu.clear.on("click",$.proxy(this._promptMenuClearValues,this))},_promptMenuSortTags:function(t){apex.debug.log(this.logPrefix,"_promptMenuSortTags",t);$(t.target);var e="asc"==this.mask.state.sorted?"desc":"asc";this.mask.state.selected.sort(this._sortJson("display",e)),this._promptRenderTags(),this.mask.state.sorted=e,this.prompt.isVisible&&this.prompt.menu.sort.removeClass("asc desc").addClass(e),this.prompt.input.focus()},_promptMenuClearValues:function(){apex.debug.log(this.logPrefix,"_promptMenuClearValues"),this._promptEmptyMask(),this._promptEmptyTags(),this._promptLiRemoveSelection(),this._promptReposition(),this._promptSelectFirstRow(),this._promptApplyValues(!0),this.prompt.input.focus()},_promptRenderTags:function(){apex.debug.log(this.logPrefix,"_promptRenderTags");var t=0,e=this.pluginSettings.prompt.tagsNo;this._promptEmptyTags();for(var i=0;i<this.mask.state.selected.length;i++){if(this.pluginSettings.prompt.areTagsLimited&&i>=e){this._promptTagsSummary(this.mask.state.selected.length-t);break}this.pluginSettings.displayExtra&&this.mask.state.selected[i].isExtraValue?(this._promptTagsAddNew(this.mask.state.selected[i].display,this.mask.state.selected[i].value,this.mask.state.selected[i].isExtraValue),t++):!this.pluginSettings.displayExtra&&this.mask.state.selected[i].isExtraValue?apex.debug.log(this.logPrefix,"_promptRenderTags",'value "'+this.mask.state.selected[i].value+'" is not in value from sql query.'):(this._promptTagsAddNew(this.mask.state.selected[i].display,this.mask.state.selected[i].value,this.mask.state.selected[i].isExtraValue),t++)}0!=t||this.pluginSettings.prompt.areTagsLimited?this._promptPlaceHolderHide():this._promptPlaceHolderShow()},_promptMenuChangeView:function(){apex.debug.log(this.logPrefix,"_promptMenuChangeView"),this.mask.container.is(".expanded")?(this.mask.container.removeClass("expanded"),this.prompt.menu.expand.removeClass("expanded")):(this.mask.container.addClass("expanded"),this.prompt.menu.expand.addClass("expanded")),this._promptReposition(),this.prompt.input.focus()},_promptUnhighlightOther:function(t){apex.debug.log(this.logPrefix,"_promptUnhighlightOther"),this.prompt.body.find("li").not(t.target).removeAttr("aria-highlighted")},_promptScrollCallback:function(t){apex.debug.log(this.logPrefix,"_promptScrollCallback","pEvent",t,"scrollTop",this.prompt.body.scrollTop());var e=this._getScrollPercent(this.prompt.body,this.pluginSettings.prompt.maxHeight);e>90&&0==this.mask.state.ajaxRunning?(apex.debug.log(this.logPrefix,"_promptScrollCallback","Reached over 90% of container scroll. Perform AJAX"),this._promptAjaxPerform(++this.mask.state.lastFetchedPage)):e>90&&1==this.mask.state.ajaxRunning?apex.debug.log(this.logPrefix,"_promptScrollCallback","There is AJAX awaiting for results. AJAX not performed"):apex.debug.log(this.logPrefix,"_promptScrollCallback","Just scroll. do nothing")},_promptInputBlur:function(){apex.debug.log(this.logPrefix,"_promptInputBlur")},_promptInputFocus:function(){apex.debug.log(this.logPrefix,"_promptInputFocus")},_promptDisplayError:function(t){apex.debug.log(this.logPrefix,"_promptDisplayError","pText",t,this.prompt),this.prompt.body.html('<div class="promptError"><span class="fa fa-exclamation-triangle"></span> '+t+"</div>")},_promptLiRemoveSelection:function(){apex.debug.log(this.logPrefix,"_promptHiglightRemoveAll"),this.prompt.body.find("[aria-selected=true]").removeAttr("aria-selected")},_promptHiglightRemoveCurrentLi:function(){this.mask.state.currentSelection.removeAttr("aria-highlighted"),this.mask.state.currentSelection=void 0},_promptHighlightLi:function(t){null!=this.mask.state.currentSelection&&this._promptHiglightRemoveCurrentLi(),this.mask.state.currentSelection=t,t.attr("aria-highlighted",!0)},_promptSelectFirstRow:function(){apex.debug.log(this.logPrefix,"_promptSelectFirstRow");var t=this.prompt.body.find("li").first();this._promptHighlightLi(t)},_dataExtendSelectedFromArrayOfObjects:function(t,e){for(var i in t.data)for(var o=0;o<e.length;o++)e[o].value.toString()!=t.data[i].R.toString()||(t.data[i].selected=!0);return apex.debug.log(this.logPrefix,"_dataExtendSelectedFromArrayOfObjects","returned pData",t),t},_promptTemplateDefault:function(){apex.debug.log(this.logPrefix,"_promptTemplateDefault");return'{{#data}}<li aria-return-value="{{{R}}}" aria-display-value="{{{D}}}" {{#selected}}aria-selected="true"{{/selected}} {{#isAPEXNullValue}}aria-null-value="true"{{/isAPEXNullValue}} title="{{{D}}}" class="default"> {{{D}}}</li>{{/data}}'},_promptRenderDataInCustomTemplate:function(t){apex.debug.log(this.logPrefix,"_promptRenderDataInCustomTemplate","pData",t);for(var e,i="",o=!1,p=0;p<t.data.length;p++)o=!!t.data[p].selected,e=this.prompt.customTemplateFunction.call(this,t.data[p]),i+='<li title="'+t.data[p].D+'" class="custom" aria-return-value="'+t.data[p].R+'" aria-display-value="'+t.data[p].D+'" aria-selected="'+o+'">'+e+"</li>";return i},_promptAppendData:function(t){apex.debug.log(this.logPrefix,"_promptAppendData","pData",t);var e,i=this._promptTemplateDefault();if(0!=t.data.length){if(0==this.pluginSettings.prompt.isCustomTemplate){apex.debug.log(this.logPrefix,"_promptAppendData","render data in default template");try{e=$(Mustache.render(i,t))}catch(t){this._throwError(t)}}else apex.debug.log(this.logPrefix,"_promptAppendData","render data in custom template"),e=this._promptRenderDataInCustomTemplate(t);this.prompt.body.find("ul").append(e),this._promptReposition(),this._triggerEvent("paeli_prompt_data_appended",this._promptGetEventData())}},_promptDrawMinimalInputLength:function(t){apex.debug.log(this.logPrefix,"_promptDrawMinimalInputLength");var e='<div class="nodatafound">  <span class="text">'+t.replace("%0",this.pluginSettings.prompt.minimalInputLength)+"</span></div>";this.prompt.body.html(e),this.mask.state.areResultsAvailable=!1},_promptDrawNodataFound:function(){apex.debug.log(this.logPrefix,"_promptDrawNodataFound");var t='<div class="nodatafound">  <span class="fa fa-table-search icon"></span>  <span class="text">'+this.C_PROMPT_TEXT_NO_DATA_FOUND+"</span></div>";this.prompt.body.html(t),this.mask.state.areResultsAvailable=!1},_promptRenderData:function(t){apex.debug.log(this.logPrefix,"_promptRenderData","pData",t);var e,i=this._promptTemplateDefault();if(0!=t.data.length){if(this._checkIfDataContainsDisplayColumn(t)||this._checkIfDataContainsReturnColumn(t)||(this._promptDisplayError("Invalid SQL query"),this._throwErrorText('SQL query lacks display and return columns. Aliases "d" and "r" are required!')),0==this.pluginSettings.prompt.isCustomTemplate){apex.debug.log(this.logPrefix,"_promptRenderData","render data in default template"),i="<ul>"+i+"</ul>";try{e=$(Mustache.render(i,t))}catch(t){this._throwError(t)}}else apex.debug.log(this.logPrefix,"_promptRenderData","render data in custom template"),e="<ul>"+(e=this._promptRenderDataInCustomTemplate(t))+"</ul>";this.prompt.body.html(e),this._promptReposition(),this.mask.state.areResultsAvailable=!0,this._promptSelectFirstRow(),this._triggerEvent("paeli_prompt_data_rendered",this._promptGetEventData())}else this._promptDrawNodataFound()},_promptGetHiglighted:function(){return this.prompt.body.find('[aria-highlighted="true"]')},_maskPopupButtonKeyDown:function(t){apex.debug.log(this.logPrefix,"_maskPopupButtonKeyDown",t);var e=t.keyCode;"DOWN"==this._isNavigationKey(e)&&this._promptSearchInputFocusHandler()},_maskStateSelectedRemove:function(t,e){var i;apex.debug.log(this.logPrefix,"_maskStateSelectedRemove","pIndex",t),i=this.mask.state.selected.splice(t,1),apex.debug.log(this.logPrefix,"_maskStateSelectedRemove","removed object",i),e&&this._promptApplyValues(e)},_maskStateSelectedAdd:function(t,e,i,o){apex.debug.log(this.logPrefix,"_maskStateSelectedAdd","pObject",t,"pTriggerChangeEvent",e,i),i&&(t.isExtraValue=!0),o&&(t.isAPEXNullValue=!0),this.mask.state.selected.push(t),e&&this._promptApplyValues(e)},_maskStateSelectedGetIndex:function(t){apex.debug.log(this.logPrefix,"_maskStateSelectedGetIndex",t);for(var e=0;e<this.mask.state.selected.length;e++)if(this.mask.state.selected[e].value==t)return e;return-1},_promptIsValueSelected:function(t){return apex.debug.log(this.logPrefix,"_promptIsValueSelected",t),this.mask.state.selected.indexOf(t)>-1},_promptRemoveHighlightedfromAllLi:function(){apex.debug.log(this.logPrefix,"_promptRemoveHighlightedfromAllLi"),this.prompt.body.find("li[aria-highlighted]").removeAttr("aria-highlighted")},_promptRemoveHighlightedFromLi:function(t){apex.debug.log(this.logPrefix,"_promptRemoveHighlightedFromLi","pLi",t),t.removeAttr("aria-highlighted")},_promptUnselectValue:function(t,e){apex.debug.log(this.logPrefix,"_promptUnselectValue","pValue",t),apex.debug.log(this.logPrefix,"_promptUnselectValue","pLi",e);var i=t,o=this._maskStateSelectedGetIndex(i),p=!0;o<0?this._throwErrorText(' Value "'+t+'" is not selected!'):p=!1,this._maskStateSelectedRemove(o,p),null!=e&&e.removeAttr("aria-selected"),this._maskTagRemove(i),this.prompt.isVisible&&this._promptReposition()},_promptGetLiSelected:function(){return apex.debug.log(this.logPrefix,"_promptGetLiSelected"),this.prompt.body.find("li").filter((function(t,e){return $(e).is("[aria-selected=true]")}))},_promptSelectValue:function(t){apex.debug.log(this.logPrefix,"_promptSelectValue",t.get(0));var e=t.attr("aria-return-value"),i=t.attr("aria-display-value"),o=t.attr("aria-null-value"),p=this._promptGetLiSelected().first();if(0!=this.mask.state.areResultsAvailable){if(0==this.pluginSettings.isMultipleSelection&&1==this.mask.state.selected.length){apex.debug.log(this.logPrefix,"_promptLiClickHanlder deselect and select new");try{this._promptUnselectValue(p.attr("aria-return-value"),p)}catch(t){this._promptEmptyTags(),this._promptEmptyMask()}}else 0==this.pluginSettings.isMultipleSelection&&this.mask.state.selected.length>1&&(this._promptRemoveHighlightedfromAllLi(),this._promptEmptyTags(),this._promptEmptyMask());this._maskStateSelectedAdd({display:i,value:e},!0,!1,"true"==o),t.attr("aria-selected",!0),this._promptHighlightLi(t),this.mask.state.currentSelection=t,this.prompt.isVisible&&(this._promptReposition(),this.prompt.input.focus()),this.pluginSettings.isMultipleSelection?this.pluginSettings.prompt.isRapidSelection&&this.prompt.input.val().length>0&&this.prompt.input.val(null).trigger("keyup"):this.pluginSettings.prompt.isRapidSelection?this.prompt.input.val().length>0&&this.prompt.input.val(null).trigger("keyup"):this._promptHide(this.mask.itemContainer)}else apex.debug.log(this.logPrefix,"_promptLiClickHanlder no results to be selected!")},_promptApplyValues:function(t){apex.debug.log(this.logPrefix,"_promptApplyValues","pTriggerChange",t),apex.debug.log(this.logPrefix,"_promptApplyValues","values",this.mask.state.selected.length);var e=[];if(this.mask.state.selected.length>0){for(var i=0;i<this.mask.state.selected.length;i++)e.push(this.mask.state.selected[i].value);this.element.val(e.join(this.C_VALUE_SEPARATOR)),this.mask.state.selected.sort(this._sortJson("display",this.mask.state.sorted)),this._promptRenderTags()}else this.element.val(null),this._promptEmptyTags(),this._promptPlaceHolderShow();t&&(apex.debug.log(this.logPrefix,"_promptApplyValues","trigger Change",this),apex.event.trigger(this.element.get(0),"change",this))},_promptTagsGetObject:function(t){apex.debug.log(this.logPrefix,"_promptTagsGetObject",t);for(var e=0;e<this.mask.state.tags.length;e++)if(this.mask.state.tags[e].value==t)return apex.debug.log(this.logPrefix,"_promptTagsGetObject","pReturn has index "+e),this.mask.state.tags[e];apex.debug.log(this.logPrefix,"_promptTagsGetObject","pReturn is not in tags list")},_promptTagsGetIndex:function(t){apex.debug.log(this.logPrefix,"_promptTagsGetIndex",t,"in",this.mask.state.tags);for(var e=0;e<this.mask.state.tags.length;e++)if(this.mask.state.tags[e].value==t)return apex.debug.log(this.logPrefix,"_promptTagsGetIndex","pReturn has index "+e),e;return apex.debug.log(this.logPrefix,"_promptTagsGetIndex","pReturn is not in tags list"),-1},_promptGetLiByReturnValue:function(t){apex.debug.log(this.logPrefix,"_promptGetLiByReturnValue",t);var e=this.prompt.body.find("li").filter((function(e,i){return $(i).attr("aria-return-value").toString()==t.toString()}));return e.length>0?apex.debug.log(this.logPrefix,"_promptGetLiByReturnValue","found li element",e):apex.debug.log(this.logPrefix,"_promptGetLiByReturnValue","there is no li element with return value",t),e},_maskRemoveTagFromDOM:function(t){apex.debug.log(this.logPrefix,"_maskRemoveTagFromDOM",t);var e=$(t.target).closest("div").attr("aria-return-value");if(this.mask.state.disabled)return apex.debug.log(this.logPrefix,"_maskRemoveTagFromDOM","APEX item is disabled, do nothing."),t.preventDefault(),void t.stopImmediatePropagation();this.prompt.isVisible&&(this._promptReposition(),this._promptGetLiByReturnValue(e).removeAttr("aria-selected")),this._maskStateSelectedRemove(this._maskStateSelectedGetIndex(e)),t.stopImmediatePropagation(),this._promptApplyValues(!0)},_maskTagRemove:function(t){apex.debug.log(this.logPrefix,"_maskTagRemove",t);var e,i=this._promptTagsGetIndex(t);i<0?apex.debug.log(this.logPrefix,"_maskTagRemove","Tag not found"):(e=this.mask.state.tags[i],apex.debug.log(this.logPrefix,"_maskTagRemove","tag to be removed from DOM",e),e.container.remove(),this.mask.state.tags.splice(i,1))},_promptTagsAddNew:function(t,e,i){apex.debug.log(this.logPrefix,"_promptTagsAddNew",t,e,i);var o=$('<div class="tag'+(i?" extra":"")+'" aria-return-value="'+e+'" title="'+t+'">  <span class="value">'+t+'</span>  <span class="fa fa-times remove"></span></div>'),p={value:e,display:t,container:o,isExtraValue:!!i};this.mask.state.tags.push(p),this.mask.tagsContainer.append(o)},_promptTagsSummaryOpenSelected:function(){apex.debug.log(this.logPrefix,"_promptTagsSummaryOpenSelected"),this.pluginSettings.isPopupReportAvailable&&(apex.debug.log(this.logPrefix,"_promptTagsSummaryOpenSelected, popup not available, do nth"),this.popup.showSelectedCheckbox.prop("checked",!0),this._popupOpen())},_promptTagsSummary:function(t){var e;apex.debug.log(this.logPrefix,"_promptTagsSummary",t),summaryTag=$('<div class="tag summary">default summary</div>'),e=this.pluginSettings.prompt.areTagsLimited&&this.pluginSettings.prompt.tagsNo>0?this.C_TAGS_LIMITED_OTHERS.replace("%0",t):this.C_TAGS_LIMITED_0.replace("%0",t),summaryTag.text(e),summaryTag.on("click",(function(t){t.stopImmediatePropagation()})),summaryTag.on("dblclick",$.proxy(this._promptTagsSummaryOpenSelected,this)),this.mask.tagsContainer.append(summaryTag)},_promptCheckClickOutside:function(t){apex.debug.log(this.logPrefix,"_promptCheckClickOutside",t.currentTarget,t.target),$.contains(this.prompt.container.get(0),t.target)||$.contains(this.mask.container.get(0),t.target)||$(t.target).is(".remove")||window.getSelection().toString().length>0||this._promptHide(void 0)},_getNextFocusAble:function(){var t,e,i;return apex.debug.log(this.logPrefix,"_getNextFocusAble"),this.element.show(),e=(t=$(":tabbable").toArray()).indexOf(this.element.get(0)),i=t[e+1],this.element.hide(),$(i)},_promptNavigateArrows:function(t){var e,i,o,p,s=this.prompt.body.find("li").length,a=(this.mask.state.currentSelection.prevAll().length,this.mask.state.currentSelection.nextAll().length,this.prompt.body.scrollTop());if("DOWN"==t)i=this.mask.state.currentSelection.next();else{if("UP"!=t)return;i=this.mask.state.currentSelection.prev()}o=i.position(),i.length>0?(this._promptHighlightLi(i),(e=o.top-a)>=0&&e<=this.pluginSettings.prompt.maxHeight-i.outerHeight()||(p="DOWN"==t?a+(e+i.outerHeight()-this.pluginSettings.prompt.maxHeight):a+e,this.prompt.body.scrollTop(p))):s<this.mask.state.totalCount&&this._promptAjaxPerform(++this.mask.state.lastFetchedPage)},_promptLiClickHanlder:function(t){apex.debug.log(this.logPrefix,"_promptLiClickHanlder",t);var e=$(t.target).is("li")?$(t.target):$(t.target).closest("li");e.is('[aria-selected="true"]')?this._promptUnselectValue(e.attr("aria-return-value"),e):(apex.debug.log(this.logPrefix,"_promptLiClickHanlder currently selected items: ",this.mask.state.selected.length,this.mask.state.selected),this._promptSelectValue(e))},_maskHandleFocus:function(t){apex.debug.log(this.logPrefix,"_maskHandleFocus",t)},_maskHandleBlur:function(t){apex.debug.log(this.logPrefix,"_maskHandleBlur",t)},_maskHandleKeyDown:function(t){apex.debug.log(this.logPrefix,"_maskHandleKeyDown",t);var e=t.keyCode;"DOWN"==this._isNavigationKey(e)&&this._promptSearchInputFocusHandler()},_maskHandleKeyPress:function(t){apex.debug.log(this.logPrefix,"_maskHandleKeyPress",t),this._promptCreateNew(),this._promptAddListeners(),13!=t.keyCode&&this.prompt.input.val(t.key),this.prompt.input.trigger("keyup"),this._promptShow(),setTimeout($.proxy((function(){this.prompt.input.focus()}),this),100)},_promptFakeCursorHandler:function(t){apex.debug.log(this.logPrefix,"_promptFakeCursorHandler",t);var e=$('<input type="text" class="fakeCursorHandler">');return this.mask.itemContainerBody.append(e),setTimeout($.proxy((function(t){t.on("blur",(function(t){$(t.target).remove()})).on("keypress",$.proxy((function(t){var e=$(t.target),i=e.val();t.stopImmediatePropagation(),t.preventDefault(),this._promptCreateNew(),this._promptAddListeners(),this.prompt.input.val(i).trigger("keyup"),setTimeout($.proxy((function(){this.prompt.input.focus()}),this),100),this.prompt.input.focus(),e.remove(),this._promptShow()}),this)),e.focus()}),this,e),100),!1},_promptSearchInputFocusHandler:function(t){apex.debug.log(this.logPrefix,"_promptSearchInputFocusHandler"),this.mask.state.disabled?apex.debug.log(this.logPrefix,"_promptSearchInputFocusHandler","APEX item is disabled, do nothing."):this.pluginSettings.isAutocompleteAvailable?null==this.prompt.container&&(this._promptCreateNew(),this._promptAddListeners(),this._promptShow(),this.pluginSettings.prompt.isMinimalInputLength&&0==this.pluginSettings.prompt.minimalInputLength?this._promptDrawMinimalInputLength(this.C_PROMPT_TEXT_MINIMAL_INPUT_LENGTH_0):this.pluginSettings.prompt.isMinimalInputLength&&this._promptIsMinimalInputLengthMatched()?this._promptDrawMinimalInputLength(this.C_PROMPT_TEXT_MINIMAL_INPUT_LENGTH_X):this._promptAjaxPerform(),this.prompt.input.focus()):apex.debug.log(this.logPrefix,"_promptSearchInputFocusHandler","Autocomplete is not available")},_promptIsMinimalInputLengthMatched:function(){var t=this.pluginSettings.prompt.minimalInputLength>this.prompt.input.val().length;return apex.debug.log(this.logPrefix,"_promptIsMinimalInputLengthMatched returns",t),t},_sortJson:function(t,e){var i;return apex.debug.log(this.logPrefix,"_sortJson",t,e),i="asc"==e?1:-1,function(e,o){return(e[t]<o[t]?-1:e[t]>o[t]?1:0)*i}},_highlightWord:function(t,e){apex.debug.log(this.logPrefix,"_highlightWord",t,e);var i,o,p=t,s=e,a=p.toUpperCase().indexOf(s.toUpperCase());return a>-1?(i=p.substr(0,a))+'<span class="highlight">'+(o=p.substr(i.length,s.length))+"</span>"+p.substr(a+o.length,p.length):t},_getItemContainer:function(){return this.mask.container.find(".itemContainer")},_getItemContainerBody:function(){return this.mask.container.find(".itemContainerBody")},_getTagsContainer:function(){return this.mask.container.find(".tags")},_getMaskInput:function(){return this.mask.container.find(".fakeInput")},_isNavigationKey:function(t){return 40==t?"DOWN":38==t?"UP":37==t?"LEFT":39==t&&"RIGHT"},_maskGetValue:function(){return apex.debug.log(this.logPrefix,"_maskGetValue"),this.prompt.input.val()},_maskKeyUpManageIcons:function(){apex.debug.log(this.logPrefix,"_maskKeyUpManageIcons"),0==this.popup.search.val().length?this.popup.search.addClass("empty"):this.popup.search.removeClass("empty")},_promptInputKeyDownHandler:function(t){var e=t.keyCode,i=this._isNavigationKey(e);if(t.shiftKey)return!1;if(9==e)apex.debug.log(this.logPrefix,"_promptInputKeyDownHandler","TAB key pressed."),this._promptHide(this.mask.popupButton);else{if(27==e)return apex.debug.log(this.logPrefix,"_promptInputKeyDownHandler","ESCAPE key pressed."),this._promptHide(this.mask.itemContainer),!1;i&&(this.mask.state.areResultsAvailable?(t.preventDefault(),t.stopImmediatePropagation(),this._promptNavigateArrows(i)):apex.debug.log(this.logPrefix,"_promptInputKeyDownHandler","no results available"))}},_maskKeyUp:function(t){apex.debug.log(this.logPrefix,"_maskKeyUp",t);var e=t.keyCode,i=this._isNavigationKey(e),o=this._promptGetHiglighted();return 9==e?(apex.debug.log(this.logPrefix,"_maskKeyUp","TAB key released. Do not perform autocomplete because it was already"),!1):16==e?(apex.debug.log(this.logPrefix,"_maskKeyUp","SHIFT key released. Do not perform autocomplete"),!1):!i&&(13==e?(apex.debug.log(this.logPrefix,"_maskKeyUp","enter pressed"),0==this.mask.state.areResultsAvailable?(apex.debug.log(this.logPrefix,"_maskKeyUp","results are not yet available"),!1):(o.is('[aria-selected="true"]')?this._promptUnselectValue(o.attr("aria-return-value"),o):this._promptSelectValue(o),!1)):void(this.pluginSettings.prompt.isMinimalInputLength&&0==this.pluginSettings.prompt.minimalInputLength&&0==this.prompt.input.val().length?this._promptDrawMinimalInputLength(this.C_PROMPT_TEXT_MINIMAL_INPUT_LENGTH_0):this.pluginSettings.prompt.isMinimalInputLength&&this._promptIsMinimalInputLengthMatched()?this._promptDrawMinimalInputLength(this.C_PROMPT_TEXT_MINIMAL_INPUT_LENGTH_X):this._promptAjaxPerform()))},_checkIfDataContainsDisplayColumn:function(t){apex.debug.log(this.logPrefix,"_checkIfDataContainsDisplayColumn","pData",t);var e=!1;for(var i in t.data)if(null!=t.data[i].D){e=!0;break}return e},_checkIfDataContainsReturnColumn:function(t){apex.debug.log(this.logPrefix,"_checkIfDataContainsReturnColumn","pData",t);var e=!1;for(var i in t.data)if(null!=t.data[i].R){e=!0;break}return e},_getScrollPercent:function(t,e){var i;return i=(i=100*t.scrollTop()/(t.children().outerHeight()-e))>100?100:i,apex.debug.log(this.logPrefix,"_getScrollPercent","result",i),i},_createItemPopupButton:function(){apex.debug.log(this.logPrefix,"_createItemPopupButton");var t=$("<button></button>"),e=$("<span></span>");return e.addClass("fa "+this.options.item.icon),t.addClass("a-Button a-Button--popupLOV"),t.attr("id",this.options.item.name+"_BUTTON"),t.attr("onclick","return false;"),t.append(e),t},_createItemAjaxButton:function(){apex.debug.log(this.logPrefix,"_createItemAjaxButton");var t=$("<button></button>"),e=$("<span></span>");return e.addClass("fa fa-search icon"),t.addClass("a-Button a-Button--ajaxIndicator a-Button--popupLOV"),t.attr("id",this.options.item.name+"_BUTTON_AJAX"),t.attr("onclick","function(){return false;}"),t.append(e),t},_maskCreateNew:function(){apex.debug.log(this.logPrefix,"_maskCreateNew","element",this.element.get(0));var t=null!=this.element.get(0).attributes.class?this.element.get(0).attributes.class.value.split(" "):[],e=$('<div class="masking"></div>'),i=this._createItemPopupButton(),o=this._createItemAjaxButton(),p=$('<div class="placeholder">'+this.element.attr("placeholder")+"</div>"),s=$("<div></div>"),a=$("<div></div>"),n=$("<div></div>"),r=$("<div></div>");for(var l in apex.debug.log(this.logPrefix,"_maskCreateNew","classes",t),s.addClass("pretius--enhancedLovItem mask"),t)s.addClass(t[l]+"-mask");return a.addClass("itemContainer").css("borderColor",this.inputCss.borderColor),1==this.pluginSettings.isAutocompleteAvailable&&a.attr("tabindex",0),n.addClass("itemContainerBody").append(r.addClass("tags")).append(e).appendTo(a),a.append(p),a.appendTo(s),this.pluginSettings.isPopupReportAvailable&&(i.on("click",$.proxy(this._popupOpenByButton,this)),a.after(i)),a.after(o.hide()),{container:s,itemContainer:a,itemContainerBody:n,tagsContainer:r,placeholder:p,popupButton:i,ajaxStateButton:{button:o,errorMessage:void 0,isError:!1}}},_writeQueryToConsole:function(t){apex.debug.log(this.logPrefix,"_writeQueryToConsole","start");for(var e=t.split("\n"),i=0;i<e.length;i++)apex.debug.log("#",e[i]);apex.debug.log(this.logPrefix,"_writeQueryToConsole","end")},_throwErrorText:function(t){throw apex.debug.log(this.logPrefix,"_throwErrorText","pText",t),t},_debounce:function(t,e,i){var o;return function(){var p=this,s=arguments,a=function(){o=null,i||t.apply(p,s)},n=i&&!o;clearTimeout(o),o=setTimeout(a,e),n&&t.apply(p,s)}},_throwError:function(t){throw apex.debug.log(this.logPrefix,"_throwError","pErrorThrown",t),t}});